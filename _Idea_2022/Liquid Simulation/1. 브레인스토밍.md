
> 2022. 11. 30


# 0. Question
---
- 물방울들의 충돌 시뮬레이션 필요 여부
  => 충돌체가 반드시 필요한가?

- 액체의 점성과 인력 표현
  => 레이마칭
  => 동적 메시 변형(융합/분리)





# 1. 충돌 시뮬레이션
---

## 요구사항
- 작은 구체(Sphere)들의 상호 충돌 구현
- 모든 구체들이 서로 충돌해야 함
- 액체가 보관될 반투명 수조에 대한 충돌 처리
- 모든 구체가 서로 충돌하도록 계산하면 성능 소모가 클 수 있으므로, 트리/프루닝/그리드 등의 최적화 방안 필요
- 단순히 충돌하고 이후 멈추면 매우 부자연스러울 수 있기 때문에, 이를 보완하기 위한 군집 탄성력 등을 통해 액체 표현 필요

## 테스트 시 조작 변인
- 각 구체의 반지름
- 구체 반지름의 랜덤성
- 탄성력
- 중력
- 최대 가속도
- 인접 판단 최대 거리

## 구현방법
- 컴퓨트 쉐이더
  - 버퍼
    - 버텍스 좌표(xyz) 및 반지름(w) : vec4
    - (가정) 최적화 그리드 인덱스 벡터(int3) => 월드 좌표를 기반으로, 현재 속한 그리드의 인덱스를 정수로 기억
                                                인접한 인덱스를 갖는 그리드(인접 여부는 제한 가속도에 따라 최대 인덱스 계산 범위 결정)
                                                내의 구체끼리만 충돌 계산

# 2. 메시/그래픽
---

## 요구사항
- 구체가 홀로 있을 경우 단일 물방울처럼 보여야 함
- 구체가 가까이 붙으면 서로 연결된 방울로 보여야 함
- 구체가 너무 구체처럼 보이면 안되고, 액체처럼 자연스럽게 보여야 함

## 구현방법 - [1] 실시간 변동 메시 구축
- 연결된 구체들이 버텍스로서 동작
- 이에 따라 연결된 모든 버텍스의 외곽만을 서로 연결하여, 실시간 메시 구축
- 메시가 뾰족해보일 수 있으므로 지오메트리 쉐이더 또는 테셀레이션 쉐이더 혹은 가상의 버텍스 추가를 통한 보간 필요
- 어떤 구체에 인접한 다른 구체가 없을 경우, 하나의 버텍스가 아니라 스스로 여러 버텍스를 갖는 하나의 Sphere 메시를 가짐

## 구현방법 - [2] 레이마칭
- 각각의 구체들이 레이마칭에서 가장 가벼운 sdf인 Sphere로 표현
- Sphere끼리는 SMAX 연산을 통해 부드럽게 연결되도록 표현
- 레이마칭의 최고 강점 : 액체에 대한 자연스로운 표현 가능, `점도(점성)` 표현 및 조절 가능

- 최적화 :  모든 구체에 대해 sdf 연산을 할 경우, 굉장히 성능 부담이 될 수 있으므로 외곽 검출을 통해 외곽만 레이마칭 연산
  => 외곽 검출 알고리즘 필요

- 최적화:  스크린 픽셀 좌표에서 여러 렌더링 대상 구체 중 가장 가까운 표면의 렌더링을 했을 경우, 반대편 표면의 렌더링 연산은 하지 않음?
  => 뷰 벡터(-rd)와 해당 외곽 표면의 노멀 벡터의 Dot 연산을 통해 판단 가능할듯

