<!DOCTYPE html>



<html lang="en" 
  
    mode="dark"
  
>

  <!--
  The Head
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme" content="Chirpy v2.7.2">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="유니티 - Voxel System(마인크래프트 구현하기) [TODO]" />
<meta name="author" content="Rito15" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="목차" />
<meta property="og:description" content="목차" />
<link rel="canonical" href="https://rito15.github.io/posts/unity-study-voxel/" />
<meta property="og:url" content="https://rito15.github.io/posts/unity-study-voxel/" />
<meta property="og:site_name" content="Rito15" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-26T20:40:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="유니티 - Voxel System(마인크래프트 구현하기) [TODO]" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"목차","datePublished":"2021-03-26T20:40:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rito15.github.io/posts/unity-study-voxel/"},"url":"https://rito15.github.io/posts/unity-study-voxel/","author":{"@type":"Person","name":"Rito15"},"headline":"유니티 - Voxel System(마인크래프트 구현하기) [TODO]","dateModified":"2021-09-17T04:13:36+09:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>유니티 - Voxel System(마인크래프트 구현하기) [TODO] | Rito15
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2019 Cotes Chung
  Published under the MIT license
-->



<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
    integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
    crossorigin="anonymous">

  <!--
  CSS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->






<link rel="preload" href="/assets/css/post.css" as="style">
<link rel="stylesheet" href="/assets/css/post.css">


  
    <link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css">
    <link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" />
  



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->





<script async src="/assets/js/post.min.js"></script>


  <!-- MathJax -->
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>





</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/favicons/android-icon-192x192.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Rito15</a>
    </div>

    <div class="site-subtitle font-italic">Game Programmer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/tabs/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/rito15" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ghdtkals15','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
      
        
        <span>
          <a href="/">
            Posts
          </a>
        </span>
        
      

      
        <span>유니티 - Voxel System(마인크래프트 구현하기) [TODO]</span>
      

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>유니티 - Voxel System(마인크래프트 구현하기) [TODO]</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Fri, Mar 26, 2021,  8:40 PM +0900"
  >

  
  

  
    Mar 26, 2021
  

  <i class="unloaded">2021-03-26T20:40:00+09:00</i>

</span>
          by
          <span class="author">
            Rito15
          </span>
        </div>

        <div>
          <!-- lastmod -->
          
          <span>
            Updated
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago lastmod"
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Fri, Sep 17, 2021,  4:13 AM +0900"
  >

  
  

  
    Sep 17, 2021
  

  <i class="unloaded">2021-09-17T04:13:36+09:00</i>

</span>
          </span>
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->






<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="10568 words">58 min</span>


          <!-- page views -->
          

          <!-- HITS -->
          &nbsp;
          <a href="https://hits.seeyoufarm.com"><img min-width="94" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https://rito15.github.io/posts/unity-study-voxel/%2F&count_bg=%23AC58FA&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false"/></a> 

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <h1 id="목차">목차</h1>

<ul>
  <li><a href="#목표">목표</a></li>
  <li><a href="#1-복셀-기본">1. 복셀 기본</a></li>
  <li><a href="#2-청크와-맵-데이터">2. 청크와 맵 데이터</a></li>
  <li><a href="#3-텍스쳐-입히기">3. 텍스쳐 입히기</a></li>
  <li><a href="#4-월드에서-청크-생성-및-관리하기">4. 월드에서 청크 생성 및 관리하기</a></li>
  <li><a href="#5-지형-만들기">5. 지형 만들기</a></li>
  <li><a href="#6-캐릭터-컨트롤러-만들기">6. 캐릭터 컨트롤러 만들기</a></li>
  <li><a href="#"></a></li>
</ul>

<p><br /></p>

<h1 id="목표">목표</h1>
<hr />

<ul>
  <li><a href="https://www.youtube.com/playlist?list=PLVsTSlfj0qsWEJ-5eMtXsYp03Y9yF1dEn">유튜브 강좌</a>를 따라가며 구현한다.</li>
</ul>

<p><br /></p>

<p>유니티엔진에서 마인크래프트와 같은 복셀 시스템을 구현한다.</p>

<p>모든 맵과 사물은 큐브 형태를 띠고 있으며, 생성하거나 파괴할 수 있다.</p>

<p>각각의 큐브를 개별 오브젝트로 렌더링할 경우 부하가 굉장히 크기 때문에,</p>

<p>일정 영역의 큐브들을 모아 하나의 청크(Chunk)이자 하나의 메시로 관리하는 것이 핵심이다.</p>

<p><br /></p>

<h1 id="1-복셀-기본">1. 복셀 기본</h1>
<hr />

<h2 id="큐브의-정점-데이터-정의"><strong>큐브의 정점 데이터 정의</strong></h2>

<ul>
  <li>복셀 시스템에서 사용하기 위해, 육면체 내에서 각 정점들의 인덱스 순서와 상대 위치를 미리 약속된 값으로 정의한다.</li>
</ul>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112629589-da522100-8e77-11eb-92ec-d8fbc9b0da8e.png" alt="image" /></p>

<p><br /></p>

<h2 id="lutlookup-table"><strong>LUT(LookUp Table)</strong></h2>

<ul>
  <li>육면체의 정점, 삼각형, UV를 손쉽게 참조하기 위한 LUT를 정의한다.</li>
</ul>

<details>
  <summary> 
VoxelData.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">VoxelData</span>
<span class="p">{</span>
    <span class="cm">/***********************************************************************
    *                               Lookup Tables
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

    <span class="cm">/* 
            7 ──── 6    
          / │       / │
        3 ──── 2   │
        │  │     │  │
        │  4───│─5  
        │/        │/
        0 ──── 1
    */</span>
    <span class="c1">/// &lt;summary&gt; 큐브의 8개 버텍스의 상대 위치 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Vector3</span><span class="p">[]</span> <span class="n">voxelVerts</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">8</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="c1">// Front</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// LB</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// RB</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// RT</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// LT</span>

        <span class="c1">// Back</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// LB</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// RB</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// RT</span>
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// LT</span>
    <span class="p">};</span>

    <span class="c1">// 한 면을 이루는 삼각형은 2개</span>
    <span class="c1">// 버텍스 인덱스는 시계방향으로 배치(전면으로 그려지도록)</span>
    <span class="c1">// 각 면의 버텍스 순서는 해당 면을 기준으로 LB-LT-RB, RB-LT-RT</span>
    <span class="cm">/*
        LB-LT-RB   RB-LT-RT

        1          1 ㅡ 2
        | ＼         ＼ |
        0 ㅡ 2          0
    */</span>
    <span class="c1">/// &lt;summary&gt; 큐브의 각 면을 이루는 삼각형들의 버텍스 인덱스 데이터 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span><span class="p">[,]</span> <span class="n">voxelTris</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">6</span><span class="p">,</span> <span class="m">6</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="p">{</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span> <span class="p">},</span> <span class="c1">// Back Face   (-Z)</span>
        <span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">7</span> <span class="p">},</span> <span class="c1">// Front Face  (+Z)</span>
        <span class="p">{</span><span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">6</span> <span class="p">},</span> <span class="c1">// Top Face    (+Y)</span>
        <span class="p">{</span><span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span> <span class="p">},</span> <span class="c1">// Bottom Face (-Y)</span>
        <span class="p">{</span><span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">3</span> <span class="p">},</span> <span class="c1">// Left Face   (-X)</span>
        <span class="p">{</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">6</span> <span class="p">},</span> <span class="c1">// RIght Face  (+X)</span>
    <span class="p">};</span>

    <span class="c1">/// &lt;summary&gt; voxelTris의 버텍스 인덱스 순서에 따라 정의된 UV 좌표 데이터 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Vector2</span><span class="p">[]</span> <span class="n">voxelUvs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">[</span><span class="m">6</span><span class="p">]</span>
    <span class="p">{</span>
        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// LB</span>
        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// LT</span>
        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// RB</span>

        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// RB</span>
        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// LT</span>
        <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// RT</span>
    <span class="p">};</span>

    <span class="err">#</span><span class="n">endregion</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="청크"><strong>청크</strong></h2>

<ul>
  <li>
    <p>일단 한 개의 정육면체로 이루어진 기본적인 청크를 정의한다.</p>
  </li>
  <li>
    <p>6방향의 면을 모두 그려낸다.</p>
  </li>
  <li>
    <p>LUT를 활용하여 메시의 정점, 삼각형, UV 데이터를 반복문을 통해 효율적으로 정의할 수 있다.</p>
  </li>
</ul>

<details>
  <summary> 
Chunk.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Chunk</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">MeshRenderer</span> <span class="n">meshRenderer</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">MeshFilter</span> <span class="n">meshFilter</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">vertexIndex</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;</span> <span class="n">vertices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector3</span><span class="p">&gt;();</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">triangles</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector2</span><span class="p">&gt;</span> <span class="n">uvs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Vector2</span><span class="p">&gt;();</span>

        <span class="c1">// 6방향의 면 그리기</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">p</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">;</span> <span class="n">p</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="c1">// 각 면의 삼각형 2개 그리기</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">triangleIndex</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelTris</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">];</span>

                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelVerts</span><span class="p">[</span><span class="n">triangleIndex</span><span class="p">]);</span>
                <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span><span class="p">);</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelUvs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

                <span class="n">vertexIndex</span><span class="p">++;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 메시에 데이터들 초기화</span>
        <span class="n">Mesh</span> <span class="n">mesh</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mesh</span>
        <span class="p">{</span>
            <span class="n">vertices</span> <span class="p">=</span> <span class="n">vertices</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">(),</span>
            <span class="n">triangles</span> <span class="p">=</span> <span class="n">triangles</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">(),</span>
            <span class="n">uv</span> <span class="p">=</span> <span class="n">uvs</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">()</span>
        <span class="p">};</span>

        <span class="n">mesh</span><span class="p">.</span><span class="nf">RecalculateNormals</span><span class="p">();</span> <span class="c1">// 필수</span>

        <span class="n">meshFilter</span><span class="p">.</span><span class="n">mesh</span> <span class="p">=</span> <span class="n">mesh</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="복셀-시스템의-텍스쳐"><strong>복셀 시스템의 텍스쳐</strong></h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Max Size</code>는 적당히 작게 설정한다. (강좌에서는 32)</li>
  <li><code class="language-plaintext highlighter-rouge">Wrap Mode</code>는 Clamp로, UV를 벗어나는 경우 반복되지 않게 한다.</li>
  <li><code class="language-plaintext highlighter-rouge">Filter Mode</code>는 Point로 설정하여 텍셀이 부드럽게 보간되지 않게 한다.</li>
</ul>

<p><br /></p>

<h2 id="현재-상태"><strong>현재 상태</strong></h2>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112628321-197f7280-8e76-11eb-9b6e-cdf298d67561.png" alt="image" /></p>

<p><br /></p>

<h1 id="2-청크와-맵-데이터">2. 청크와 맵 데이터</h1>
<hr />

<h2 id="정점-데이터-절약하기"><strong>정점 데이터 절약하기</strong></h2>

<p>사각형을 그리려면 2개의 삼각형을 그려야 한다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112721251-413e0b80-8f46-11eb-8fed-fad137b971e0.png" alt="image" /></p>

<p>첫 번째 삼각형은 3개의 정점으로 [LB - LT - RB], 두 번째 삼각형은 [RB - LT - RT]로 이루어져 있다.</p>

<p>따라서 <code class="language-plaintext highlighter-rouge">voxelTris</code> LUT를 만들 때 큐브의 6개의 면마다 각각 6개의 정점 인덱스로 총 36개의 정점 데이터를 이용했고,</p>

<p>메시의 <code class="language-plaintext highlighter-rouge">vertices</code> 배열에도 동일하게 버텍스를 추가했다.</p>

<p><br /></p>

<p>그런데 사각형에는 실제로 네 개의 정점이 존재하므로 이렇게 하면 큐브의 면마다 정점 두 개만큼의 데이터가 낭비되는 셈이다.</p>

<p>따라서 LUT에는 정점 6개가 아니라 4개씩만 정의하고, 메시의 <code class="language-plaintext highlighter-rouge">vertices</code> 배열에도 면마다 4개의 정점만 추가한다.</p>

<p>그리고 <code class="language-plaintext highlighter-rouge">uvs</code> 배열에도 마찬가지로 면마다 4개의 정점을 추가한다.</p>

<p>대신에 <code class="language-plaintext highlighter-rouge">triangles</code> 배열에 <code class="language-plaintext highlighter-rouge">vertices</code>의 인덱스를 추가할 때 순차적으로 (i ~ i + 6)의 인덱스를 참조하는 것이 아니라, 알맞은 정점 인덱스를 찾아 추가하면 된다.</p>

<p><br /></p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="c1">// [1] VoxelData.cs</span>

<span class="c1">// LUT - tris data (vertex indices)</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span><span class="p">[,]</span> <span class="n">voxelTris</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">6</span><span class="p">,</span> <span class="m">4</span><span class="p">]</span>
<span class="p">{</span>
    <span class="p">{</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span> <span class="p">},</span> <span class="c1">// Back Face   (-Z)</span>
    <span class="p">{</span><span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">7</span> <span class="p">},</span> <span class="c1">// Front Face  (+Z)</span>
    <span class="p">{</span><span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">6</span> <span class="p">},</span> <span class="c1">// Top Face    (+Y)</span>
    <span class="p">{</span><span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">4</span> <span class="p">},</span> <span class="c1">// Bottom Face (-Y)</span>
    <span class="p">{</span><span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">3</span> <span class="p">},</span> <span class="c1">// Left Face   (-X)</span>
    <span class="p">{</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span> <span class="p">},</span> <span class="c1">// RIght Face  (+X)</span>
<span class="p">};</span>

<span class="c1">// LUT - uv data</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Vector2</span><span class="p">[]</span> <span class="n">voxelUvs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector2</span><span class="p">[</span><span class="m">4</span><span class="p">]</span>
<span class="p">{</span>
    <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// LB</span>
    <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// LT</span>
    <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// RB</span>
    <span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">),</span> <span class="c1">// RT</span>
<span class="p">};</span>


<span class="c1">// [2] Chunk.cs</span>

<span class="c1">// 1. Vertex, UV 4개 추가</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelVerts</span><span class="p">[</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelTris</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">]]</span> <span class="p">+</span> <span class="n">pos</span><span class="p">);</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelUvs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// 2. Triangle의 버텍스 인덱스 6개 추가</span>
<span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span><span class="p">);</span>
<span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
<span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

<span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>
<span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
<span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">3</span><span class="p">);</span>

<span class="n">vertexIndex</span> <span class="p">+=</span> <span class="m">4</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h2 id="복셀-맵-구성"><strong>복셀 맵 구성</strong></h2>

<p>큐브 하나의 크기는 1 x 1 x 1로 정의한다고 할 때,</p>

<p>전체 복셀 맵은 간단히 [x, y, z] 좌표에 큐브가 존재하는지(is solid) 여부로 결정할 수 있다.</p>

<p>따라서 bool 타입의 3차원 배열로 맵을 정의할 수 있다.</p>

<p><br /></p>

<p>우선 VoxelData 클래스에서 Chunk의 width(x, z 크기), height(y 크기)를 정의한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1">// VoxelData.cs</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">ChunkWidth</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">ChunkHeight</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 이를 복셀 맵 배열의 크기로 사용한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk.cs</span>

<span class="k">private</span> <span class="kt">bool</span> <span class="p">[,,]</span> <span class="n">voxelMap</span> <span class="p">=</span> 
  <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">,</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span><span class="p">,</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">];</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>이제 voxelMap[x, y, z] == true인 좌표마다 크기가 1인 큐브 메시를 만들면 된다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk.cs</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">CreateMeshData</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">z</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">;</span> <span class="n">z</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="nf">AddVoxelDataToChunk</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">AddVoxelDataToChunk</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 6방향의 면 그리기</span>
    <span class="c1">// p : -Z, +Z, +Y, -Y, -X, +X 순서로 이루어진, 큐브의 각 면에 대한 인덱스</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">p</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">;</span> <span class="n">p</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">voxelMap</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pos</span><span class="p">.</span><span class="n">z</span><span class="p">])</span>
            <span class="k">continue</span><span class="p">;</span>

        <span class="c1">// 각 면(삼각형 2개) 그리기</span>

        <span class="c1">// 1. Vertex, UV 4개 추가</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelVerts</span><span class="p">[</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelTris</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">]]</span> <span class="p">+</span> <span class="n">pos</span><span class="p">);</span>
            <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelUvs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// 2. Triangle의 버텍스 인덱스 6개 추가</span>
        <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span><span class="p">);</span>
        <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
        <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

        <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>
        <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
        <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">3</span><span class="p">);</span>

        <span class="n">vertexIndex</span> <span class="p">+=</span> <span class="m">4</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그런데 현재 상태로 그냥 메시를 만들면 외부에서 보이지 않는 청크 내부에도 폴리곤이 만들어진다.</p>

<p>이렇게 하면 청크를 만드는 의미가 없으므로, 외부에 드러난 면만 폴리곤이 만들어지도록 해주어야 한다.</p>

<p><br /></p>

<h2 id="청크의-바깥-면만-그려주기"><strong>청크의 바깥 면만 그려주기</strong></h2>

<p>큐브가 존재하는 부분(solid)은 voxelMap[x, y, z]의 true/false 여부로 판정할 수 있게 되었지만,</p>

<p>각 면이 바깥 면인지 여부는 아직 알 수 없다.</p>

<p>따라서 이를 판정할 수 있도록 해주어야 한다.</p>

<p><br /></p>

<p>우선, 새로운 LUT를 만들어준다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// VoxelData.cs</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Vector3</span><span class="p">[]</span> <span class="n">faceChecks</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">[</span><span class="m">6</span><span class="p">]</span>
<span class="p">{</span>
    <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span> <span class="m">0.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">),</span> <span class="c1">// Back Face   (-Z)</span>
    <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span> <span class="m">0.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">,</span> <span class="p">+</span><span class="m">1.0f</span><span class="p">),</span> <span class="c1">// Front Face  (+Z)</span>
    <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span> <span class="m">0.0f</span><span class="p">,</span> <span class="p">+</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// Top Face    (+Y)</span>
    <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span> <span class="m">0.0f</span><span class="p">,</span> <span class="p">-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// Bottom Face (-Y)</span>
    <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(-</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// Left Face   (-X)</span>
    <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(+</span><span class="m">1.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">,</span>  <span class="m">0.0f</span><span class="p">),</span> <span class="c1">// RIght Face  (+X)</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>voxelTris(큐브의 6개 면마다 각각 정점 인덱스 순서) 배열의 면 순서와 동일하게,</p>

<p>faceChecks 배열을 정의한다.</p>

<p>그리고 특정 좌표가 solid인지 확인하는 메소드를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk.cs</span>

<span class="k">private</span> <span class="kt">bool</span> <span class="nf">CheckVoxel</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">FloorToInt</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">FloorToInt</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">FloorToInt</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

    <span class="c1">// 맵 범위를 벗어나는 경우</span>
    <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">x</span> <span class="p">&gt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span> <span class="p">-</span> <span class="m">1</span> <span class="p">||</span> 
       <span class="n">y</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">y</span> <span class="p">&gt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span> <span class="p">-</span> <span class="m">1</span> <span class="p">||</span>
       <span class="n">z</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">z</span> <span class="p">&gt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">voxelMap</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">];</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>이제 faceChecks 배열과 CheckVoxel() 메소드를 이용하여 청크의 바깥 면만 그려지도록 AddVoxelDataToChunk() 메소드를 수정한다.</p>

<p>원리는 간단하다.</p>

<p>큐브가 그려질 좌표에서 6개의 면마다 faceCheck를 통해 해당 면이 바라보는 방향으로 1칸 이동한 지점이 solid(true)이면 해당 면은 청크의 내부를 바라보고 있다는 의미이므로 그리지 않고,</p>

<p>false일 경우 청크의 외부를 바라보고 있다는 것이므로, 다시 말해 청크의 바깥 면이라는 것을 의미하기 때문에 해당 면은 그려주면 된다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk.cs</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">AddVoxelDataToChunk</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 6방향의 면 그리기</span>
    <span class="c1">// p : -Z, +Z, +Y, -Y, -X, +X 순서로 이루어진, 큐브의 각 면에 대한 인덱스</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">p</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">;</span> <span class="n">p</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="c1">// Face Check(면이 바라보는 방향으로 +1 이동하여 확인)를 했을 때 </span>
        <span class="c1">// Solid가 아닌 경우에만 큐브의 면이 그려지도록 하기</span>
        <span class="c1">// =&gt; 청크의 외곽 부분만 면이 그려지고, 내부에는 면이 그려지지 않도록</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">CheckVoxel</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="nf">CheckVoxel</span><span class="p">(</span><span class="n">pos</span> <span class="p">+</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">faceChecks</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="c1">// 각 면(삼각형 2개) 그리기</span>

            <span class="c1">// 1. Vertex, UV 4개 추가</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelVerts</span><span class="p">[</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelTris</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">]]</span> <span class="p">+</span> <span class="n">pos</span><span class="p">);</span>
                <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelUvs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="c1">// 2. Triangle의 버텍스 인덱스 6개 추가</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">3</span><span class="p">);</span>

            <span class="n">vertexIndex</span> <span class="p">+=</span> <span class="m">4</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h2 id="현재-상태-1"><strong>현재 상태</strong></h2>

<ul>
  <li>[1] 5 x 5 x 5 맵의 모든 부분이 true(solid)인 경우</li>
</ul>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112720764-d4297680-8f43-11eb-8746-c174c7186a0f.png" alt="image" /></p>

<ul>
  <li>[2] voxelMap[x, y, z] = (x &gt;= y &amp;&amp; z &gt;= y)</li>
</ul>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112720809-0044f780-8f44-11eb-8fb2-672e3367d2c0.png" alt="image" /></p>

<p><br /></p>

<h1 id="3-텍스쳐-입히기">3. 텍스쳐 입히기</h1>
<hr />

<h2 id="블록-타입-정의"><strong>블록 타입 정의</strong></h2>

<p>현재 bool타입의 <code class="language-plaintext highlighter-rouge">voxelMap</code>으로는 해당 좌표에 블록이 존재하는지 여부만 판단할 수 있다.</p>

<p>하지만 텍스쳐를 입히기 위해서는 블록의 타입을 구체적으로 정의할 필요가 있다.</p>

<p>우선 <code class="language-plaintext highlighter-rouge">BlockType</code> 클래스를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">BlockType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">blockName</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isSolid</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 각 블록타입들에 대한 정보를 배열로 가지고 있도록 하기 위한 <code class="language-plaintext highlighter-rouge">World</code> 컴포넌트 클래스를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">World</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Material</span> <span class="n">material</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">BlockType</span><span class="p">[]</span> <span class="n">blockTypes</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>하이라키에서 <code class="language-plaintext highlighter-rouge">World</code> 게임오브젝트를 만들고 여기에 컴포넌트로 추가한 다음, 배열의 0번 인덱스에 <code class="language-plaintext highlighter-rouge">Default</code> 블록 타입을 만들어준다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112747437-6b4c0800-8ff0-11eb-9e02-9b1636d778e6.png" alt="image" /></p>

<p><br /></p>

<p>이제 <code class="language-plaintext highlighter-rouge">Chunk</code> 클래스의 내용을 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">// bool -&gt; byte 타입 배열로 변경</span>
<span class="k">private</span> <span class="kt">byte</span> <span class="p">[,,]</span> <span class="n">voxelMap</span> <span class="p">=</span> 
  <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">,</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span><span class="p">,</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">];</span>

<span class="c1">// World 컴포넌트 참조(Start() 내부에서 FindObjectOfType&lt;World&gt;())</span>
<span class="k">private</span> <span class="n">World</span> <span class="n">world</span><span class="p">;</span>


<span class="k">private</span> <span class="kt">bool</span> <span class="nf">CheckVoxel</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="c1">// voxelMap[]의 값은 blockTypes[]의 인덱스로 사용하여,</span>
    <span class="c1">// 참조한 블록 타입에서 isSolid 값을 읽어온다.</span>
    <span class="k">return</span> <span class="n">world</span><span class="p">.</span><span class="n">blockTypes</span><span class="p">[</span><span class="n">voxelMap</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]].</span><span class="n">isSolid</span><span class="p">;</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h2 id="텍스쳐-아틀라스-사용하기"><strong>텍스쳐 아틀라스 사용하기</strong></h2>

<p>서로 다른 텍스쳐를 통째로 준비하고, 각 블록마다 다르게 입혀주려면</p>

<p>마테리얼을 분리하거나, 커스텀 쉐이더를 작성하여 필요한 텍스쳐 프로퍼티를 모두 만들어주어야 하는데</p>

<p>이는 모두 비효율적이므로</p>

<p>여러 장의 텍스쳐가 동일한 크기로 포함되어 있는 텍스쳐 아틀라스를 사용한다.</p>

<p><a href="https://www.kenney.nl/">https://www.kenney.nl/</a> 에서 무료 복셀 텍스쳐 아틀라스를 다운받아 사용하였다.</p>

<p><br /></p>

<p>예를 들어</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112750486-d226ec80-9003-11eb-93bb-cc52c4e64544.png" alt="image" /></p>

<p>이런 텍스쳐 아틀라스를 준비했을 때,</p>

<p>가로 세로 9x10 크기로 총 90개의 텍스쳐가 아틀라스 내에 들어갈 수 있다.</p>

<p>그리고 다른 크기의 아틀라스를 사용할 것을 대비하여, 월드 내에서 사용할 텍스쳐 아틀라스의 크기를 변수값으로 정의한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// VoxelData.cs</span>

<span class="c1">// 텍스쳐 아틀라스의 가로, 세로 텍스쳐 개수</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">TextureAtlasWidth</span> <span class="p">=</span> <span class="m">9</span><span class="p">;</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">TextureAtlasHeight</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

<span class="c1">// 텍스쳐 아틀라스 내에서 각 행, 열마다 텍스쳐가 갖는 크기 비율</span>
<span class="k">public</span> <span class="k">static</span> <span class="kt">float</span> <span class="n">NormalizedTextureAtlasWidth</span>
    <span class="p">=&gt;</span> <span class="m">1f</span> <span class="p">/</span> <span class="n">TextureAtlasWidth</span><span class="p">;</span>
<span class="k">public</span> <span class="k">static</span> <span class="kt">float</span> <span class="n">NormalizedTextureAtlasHeight</span>
    <span class="p">=&gt;</span> <span class="m">1f</span> <span class="p">/</span> <span class="n">TextureAtlasHeight</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>이제 텍스쳐 아틀라스 내의 각 텍스쳐를 참조할 인덱스(텍스쳐ID)를 미리 정의해야 한다.</p>

<p>유니티에서의 UV 좌표는 좌하단이 (0,0)이므로 좌하단의 텍스쳐를 인덱스 0으로 사용할 수도 있고,</p>

<p>여기서는 강좌를 따라 좌상단의 텍스쳐를 인덱스 0으로 정의하여 사용할 것이다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112750573-511c2500-9004-11eb-8a5b-3bc334c03bf9.png" alt="spritesheet_tiles_reference" /></p>

<p>그리고 텍스쳐의 인덱스를 통해 아틀라스 내의 해당 텍스쳐가 갖는 uv 좌표를 얻어오는 메소드를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk.cs</span>

<span class="c1">/// &lt;summary&gt; 텍스쳐 아틀라스 내에서 해당하는 ID의 텍스쳐가 위치한 UV를 uvs 리스트에 추가 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">AddTextureUV</span><span class="p">(</span><span class="kt">int</span> <span class="n">textureID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 아틀라스 내의 텍스쳐 가로, 세로 개수</span>
    <span class="p">(</span><span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">TextureAtlasWidth</span><span class="p">,</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">TextureAtlasHeight</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="n">textureID</span> <span class="p">%</span> <span class="n">w</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="n">h</span> <span class="p">-</span> <span class="p">(</span><span class="n">textureID</span> <span class="p">/</span> <span class="n">w</span><span class="p">)</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>

    <span class="nf">AddTextureUV</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// (x, y) : (0, 0) 기준은 좌하단</span>
<span class="c1">/// &lt;summary&gt; 텍스쳐 아틀라스 내에서 (x, y) 위치의 텍스쳐 UV를 uvs 리스트에 추가 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">AddTextureUV</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">x</span> <span class="p">&gt;=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">TextureAtlasWidth</span> <span class="p">||</span> <span class="n">y</span> <span class="p">&gt;=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">TextureAtlasHeight</span><span class="p">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IndexOutOfRangeException</span><span class="p">(</span><span class="s">$"텍스쳐 아틀라스의 범위를 벗어났습니다 : [x = </span><span class="p">{</span><span class="n">x</span><span class="p">}</span><span class="s">, y = </span><span class="p">{</span><span class="n">y</span><span class="p">}</span><span class="s">]"</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">nw</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">NormalizedTextureAtlasWidth</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">nh</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">NormalizedTextureAtlasHeight</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">uvX</span> <span class="p">=</span> <span class="n">x</span> <span class="p">*</span> <span class="n">nw</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">uvY</span> <span class="p">=</span> <span class="n">y</span> <span class="p">*</span> <span class="n">nh</span><span class="p">;</span>

    <span class="c1">// 해당 텍스쳐의 uv를 LB-LT-RB-RT 순서로 추가</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span><span class="p">,</span> <span class="n">uvY</span><span class="p">));</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span><span class="p">,</span> <span class="n">uvY</span> <span class="p">+</span> <span class="n">nh</span><span class="p">));</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span> <span class="p">+</span> <span class="n">nw</span><span class="p">,</span> <span class="n">uvY</span><span class="p">));</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span> <span class="p">+</span> <span class="n">nw</span><span class="p">,</span> <span class="n">uvY</span> <span class="p">+</span> <span class="n">nh</span><span class="p">));</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 AddVoxelDataToChunk() 메소드에서 UV를 추가하던 부분을 변경한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk.cs - AddVoxelDataToChunk()</span>

<span class="c1">// 기존</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
<span class="p">{</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelUvs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// 변경</span>
<span class="nf">AddTextureUV</span><span class="p">(</span><span class="m">43</span><span class="p">);</span> <span class="c1">// 텍스쳐 ID</span>
</pre></td></tr></tbody></table></code></div></div>

<p>새로운 마테리얼을 생성하여, <code class="language-plaintext highlighter-rouge">Unlit/Texture</code> 쉐이더를 지정하고 텍스쳐 아틀라스를 넣어준다.</p>

<p>그리고 이 마테리얼을 Chunk에 적용해준다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112750699-16ff5300-9005-11eb-894d-c90793553b3e.png" alt="image" /></p>

<p>결과 :</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112750714-2bdbe680-9005-11eb-88de-f3d63a3c761c.png" alt="image" /></p>

<p><br /></p>

<h2 id="블록의-면마다-텍스쳐-id-지정하기"><strong>블록의 면마다 텍스쳐 ID 지정하기</strong></h2>

<p>하나의 블록이라도 윗면, 옆면, 아랫면에 따라 텍스쳐가 다르게 입혀져야 한다.</p>

<p>따라서 <code class="language-plaintext highlighter-rouge">BlockType</code> 클래스를 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="c1">// VoxelData class</span>
<span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">BackFace</span>   <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">FrontFace</span>  <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
<span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">TopFace</span>    <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
<span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">BottomFace</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
<span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">LeftFace</span>   <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
<span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">RightFace</span>  <span class="p">=</span> <span class="m">5</span><span class="p">;</span>


<span class="c1">// BlockType class</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">blockName</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">bool</span> <span class="n">isSolid</span><span class="p">;</span>

<span class="p">[</span><span class="nf">Header</span><span class="p">(</span><span class="s">"Texture IDs"</span><span class="p">)]</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">topFaceTextureID</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">frontFaceTextureID</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">backFaceTextureID</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">leftFaceTextureID</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">rightFaceTextureID</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">bottomFaceTextureID</span><span class="p">;</span>

<span class="c1">// Order : Back, Front, Top, Bottom, Left, Right</span>
<span class="c1">/// &lt;summary&gt; Face Index(0~5)에 해당하는 텍스쳐 ID 리턴 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="kt">int</span> <span class="nf">GetTextureID</span><span class="p">(</span><span class="kt">int</span> <span class="n">faceIndex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">faceIndex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">TopFace</span><span class="p">:</span>    <span class="k">return</span> <span class="n">topFaceTextureID</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">FrontFace</span><span class="p">:</span>  <span class="k">return</span> <span class="n">frontFaceTextureID</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">BackFace</span><span class="p">:</span>   <span class="k">return</span> <span class="n">backFaceTextureID</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">LeftFace</span><span class="p">:</span>   <span class="k">return</span> <span class="n">leftFaceTextureID</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">RightFace</span><span class="p">:</span>  <span class="k">return</span> <span class="n">rightFaceTextureID</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">BottomFace</span><span class="p">:</span> <span class="k">return</span> <span class="n">bottomFaceTextureID</span><span class="p">;</span>

        <span class="k">default</span><span class="p">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IndexOutOfRangeException</span><span class="p">(</span><span class="s">$"Face Index must be in 0 ~ 5, but input : </span><span class="p">{</span><span class="n">faceIndex</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>그리고 <code class="language-plaintext highlighter-rouge">Chunk</code> 클래스에 다음 메소드를 추가하고,</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt; voxelMap으로부터 특정 위치에 해당하는 블록 ID 가져오기 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="kt">byte</span> <span class="nf">GetBlockID</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">voxelMap</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pos</span><span class="p">.</span><span class="n">z</span><span class="p">];</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">AddVoxelDataToChunk()</code> 메소드를 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">AddVoxelDataToChunk</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 6방향의 면 그리기</span>
    <span class="c1">// face : -Z, +Z, +Y, -Y, -X, +X 순서로 이루어진, 큐브의 각 면에 대한 인덱스</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">face</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">face</span> <span class="p">&lt;</span> <span class="m">6</span><span class="p">;</span> <span class="n">face</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="c1">// Face Check(면이 바라보는 방향으로 +1 이동하여 확인)를 했을 때 </span>
        <span class="c1">// Solid가 아닌 경우에만 큐브의 면이 그려지도록 하기</span>
        <span class="c1">// =&gt; 청크의 외곽 부분만 면이 그려지고, 내부에는 면이 그려지지 않도록</span>

        <span class="c1">// 각 면(삼각형 2개) 그리기</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">CheckVoxel</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="nf">CheckVoxel</span><span class="p">(</span><span class="n">pos</span> <span class="p">+</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">faceChecks</span><span class="p">[</span><span class="n">face</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="kt">byte</span> <span class="n">blockID</span> <span class="p">=</span> <span class="nf">GetBlockID</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>

            <span class="c1">// 1. Vertex 4개 추가</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelVerts</span><span class="p">[</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">voxelTris</span><span class="p">[</span><span class="n">face</span><span class="p">,</span> <span class="n">i</span><span class="p">]]</span> <span class="p">+</span> <span class="n">pos</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// 2. 텍스쳐에 해당하는 UV 추가</span>
            <span class="nf">AddTextureUV</span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">blockTypes</span><span class="p">[</span><span class="n">blockID</span><span class="p">].</span><span class="nf">GetTextureID</span><span class="p">(</span><span class="n">face</span><span class="p">));</span>

            <span class="c1">// 3. Triangle의 버텍스 인덱스 6개 추가</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>

            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">2</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">triangles</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">vertexIndex</span> <span class="p">+</span> <span class="m">3</span><span class="p">);</span>

            <span class="n">vertexIndex</span> <span class="p">+=</span> <span class="m">4</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>World 컴포넌트의 인스펙터에서 블록 타입마다 알맞은 텍스쳐 인덱스들을 넣어준다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112751783-b246f700-900a-11eb-8c82-cec2ed0476ca.png" alt="image" /></p>

<p>결과 :</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112751392-c1c54080-9008-11eb-8c6b-7aeaaca51739.png" alt="image" /></p>

<p><br /></p>

<p>각 텍스쳐 아틀라스 내에서 각 텍스쳐의 uv를 참조할 때 인접한 텍스쳐를 살짝 참조하여 위처럼 보기 좋지 않은 경계선들이 생길 수 있다.</p>

<p>이를 방지하기 위해, <code class="language-plaintext highlighter-rouge">AddTextureUV()</code> 메소드에서 각 uv의 offset을 연산하여 참조할 수 있도록 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">AddTextureUV</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 텍스쳐 내에서 의도치 않게 들어가는 부분 잘라내기</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">uvXBeginOffset</span> <span class="p">=</span> <span class="m">0.005f</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">uvXEndOffset</span>   <span class="p">=</span> <span class="m">0.005f</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">uvYBeginOffset</span> <span class="p">=</span> <span class="m">0.01f</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">uvYEndOffset</span>   <span class="p">=</span> <span class="m">0.01f</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">x</span> <span class="p">&gt;=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">TextureAtlasWidth</span> <span class="p">||</span> <span class="n">y</span> <span class="p">&gt;=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">TextureAtlasHeight</span><span class="p">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IndexOutOfRangeException</span><span class="p">(</span><span class="s">$"텍스쳐 아틀라스의 범위를 벗어났습니다 : [x = </span><span class="p">{</span><span class="n">x</span><span class="p">}</span><span class="s">, y = </span><span class="p">{</span><span class="n">y</span><span class="p">}</span><span class="s">]"</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">nw</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">NormalizedTextureAtlasWidth</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">nh</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">NormalizedTextureAtlasHeight</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">uvX</span> <span class="p">=</span> <span class="n">x</span> <span class="p">*</span> <span class="n">nw</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">uvY</span> <span class="p">=</span> <span class="n">y</span> <span class="p">*</span> <span class="n">nh</span><span class="p">;</span>

    <span class="c1">// 해당 텍스쳐의 uv를 LB-LT-RB-RT 순서로 추가</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span> <span class="p">+</span> <span class="n">uvXBeginOffset</span><span class="p">,</span> <span class="n">uvY</span> <span class="p">+</span> <span class="n">uvYBeginOffset</span><span class="p">));</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span> <span class="p">+</span> <span class="n">uvXBeginOffset</span><span class="p">,</span> <span class="n">uvY</span> <span class="p">+</span> <span class="n">nh</span> <span class="p">-</span> <span class="n">uvYEndOffset</span><span class="p">));</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span> <span class="p">+</span> <span class="n">nw</span> <span class="p">-</span> <span class="n">uvXEndOffset</span><span class="p">,</span> <span class="n">uvY</span> <span class="p">+</span> <span class="n">uvYBeginOffset</span><span class="p">));</span>
    <span class="n">uvs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">uvX</span> <span class="p">+</span> <span class="n">nw</span> <span class="p">-</span> <span class="n">uvXEndOffset</span><span class="p">,</span> <span class="n">uvY</span> <span class="p">+</span> <span class="n">nh</span> <span class="p">-</span> <span class="n">uvYEndOffset</span><span class="p">));</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>결과 :</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112751949-89733180-900b-11eb-9977-2074340123b3.png" alt="image" /></p>

<p><br /></p>

<p>그리고 블록 구성과 <code class="language-plaintext highlighter-rouge">PopulateVoxelMap()</code> 메소드를 적절히 수정하면 다음과 같은 결과를 얻을 수 있다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112752006-c808ec00-900b-11eb-86b8-03d699487325.png" alt="image" /></p>

<p><br /></p>

<h2 id="밉맵-생성하지-않게-하기"><strong>밉맵 생성하지 않게 하기</strong></h2>

<p>씬뷰에서 카메라를 이리저리 움직여보면</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112752033-ef5fb900-900b-11eb-8975-97a6bbc7e81f.png" alt="image" /></p>

<p>간혹 이렇게 흉하게 깨져보이는 경우를 볼 수 있다.</p>

<p>이런 경우에는 텍스쳐 인스펙터에서 <code class="language-plaintext highlighter-rouge">Advanced</code> - <code class="language-plaintext highlighter-rouge">Generate Mip Maps</code>를 체크 해제하여 밉맵을 생성하지 않게 하면 된다.</p>

<p><br /></p>

<h1 id="4-월드에서-청크-생성-및-관리하기">4. 월드에서 청크 생성 및 관리하기</h1>
<hr />

<h2 id="chunk-클래스-수정"><strong>Chunk 클래스 수정</strong></h2>

<p>Chunk 클래스가 MonoBehaviour를 상속받지 않도록 변경한다.</p>

<p>그리고 Start() 메소드에서 수행하던 동작들을 생성자로 옮긴다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk class</span>

<span class="k">private</span> <span class="n">GameObject</span> <span class="n">chunkObject</span><span class="p">;</span> <span class="c1">// 청크가 생성될 대상 게임오브젝트</span>
<span class="k">private</span> <span class="n">MeshRenderer</span> <span class="n">meshRenderer</span><span class="p">;</span>
<span class="k">private</span> <span class="n">MeshFilter</span> <span class="n">meshFilter</span><span class="p">;</span>

<span class="c1">// 생성자</span>
<span class="k">public</span> <span class="nf">Chunk</span><span class="p">(</span><span class="n">World</span> <span class="n">world</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">world</span> <span class="p">=</span> <span class="n">world</span><span class="p">;</span>

    <span class="n">chunkObject</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GameObject</span><span class="p">();</span>
    <span class="n">meshRenderer</span> <span class="p">=</span> <span class="n">chunkObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;();</span>
    <span class="n">meshFilter</span> <span class="p">=</span> <span class="n">chunkObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;();</span>

    <span class="n">meshRenderer</span><span class="p">.</span><span class="n">material</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">world</span><span class="p">.</span><span class="n">material</span><span class="p">;</span>
    <span class="n">chunkObject</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">transform</span><span class="p">);</span>

    <span class="nf">PopulateVoxelMap</span><span class="p">();</span>
    <span class="nf">CreateMeshData</span><span class="p">();</span>
    <span class="nf">CreateMesh</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>그리고 Chunk가 상대좌표를 갖도록 ChunkCoord 클래스를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">ChunkCoord</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">z</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ChunkCoord</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="n">z</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>ChunkCoord 클래스는 Chunk 내에서 필드로 사용되도록 하고, Chunk의 생성자를 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">// Chunk class</span>

<span class="k">public</span> <span class="n">ChunkCoord</span> <span class="n">coord</span><span class="p">;</span>

<span class="k">public</span> <span class="nf">Chunk</span><span class="p">(</span><span class="n">ChunkCoord</span> <span class="n">coord</span><span class="p">,</span> <span class="n">World</span> <span class="n">world</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">coord</span> <span class="p">=</span> <span class="n">coord</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="n">world</span> <span class="p">=</span> <span class="n">world</span><span class="p">;</span>

    <span class="n">chunkObject</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GameObject</span><span class="p">();</span>
    <span class="n">meshRenderer</span> <span class="p">=</span> <span class="n">chunkObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;();</span>
    <span class="n">meshFilter</span> <span class="p">=</span> <span class="n">chunkObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;();</span>

    <span class="n">meshRenderer</span><span class="p">.</span><span class="n">material</span> <span class="p">=</span> <span class="n">world</span><span class="p">.</span><span class="n">material</span><span class="p">;</span>
    <span class="n">chunkObject</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">transform</span><span class="p">);</span>
    <span class="n">chunkObject</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> 
        <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">,</span> <span class="m">0f</span><span class="p">,</span> <span class="n">coord</span><span class="p">.</span><span class="n">z</span> <span class="p">*</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">);</span>
    <span class="n">chunkObject</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="s">$"Chunk [</span><span class="p">{</span><span class="n">coord</span><span class="p">.</span><span class="n">x</span><span class="p">}</span><span class="s">, </span><span class="p">{</span><span class="n">coord</span><span class="p">.</span><span class="n">z</span><span class="p">}</span><span class="s">]"</span><span class="p">;</span>

    <span class="nf">PopulateVoxelMap</span><span class="p">();</span>
    <span class="nf">CreateMeshData</span><span class="p">();</span>
    <span class="nf">CreateMesh</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>이제 World 클래스에서 Chunk들을 생성하여 관리할 수 있다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">World</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Material</span> <span class="n">material</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">BlockType</span><span class="p">[]</span> <span class="n">blockTypes</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Chunk</span> <span class="n">chunk0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Chunk</span><span class="p">(</span><span class="k">new</span> <span class="nf">ChunkCoord</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="k">this</span><span class="p">);</span>
        <span class="n">Chunk</span> <span class="n">chunk1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Chunk</span><span class="p">(</span><span class="k">new</span> <span class="nf">ChunkCoord</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h2 id="world-클래스-수정"><strong>World 클래스 수정</strong></h2>

<p>Chunk에서 국지적으로 수행하던 기능을 World에서 담당하도록 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="c1">// World class</span>

<span class="c1">// 월드 내의 모든 청크</span>
<span class="k">private</span> <span class="n">Chunk</span><span class="p">[,]</span> <span class="n">chunks</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Chunk</span><span class="p">[</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInChunks</span><span class="p">,</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInChunks</span><span class="p">];</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">GenerateWorld</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">GenerateWorld</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInChunks</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">z</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInChunks</span><span class="p">;</span> <span class="n">z</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="nf">CreateNewChunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">CreateNewChunk</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">chunks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Chunk</span><span class="p">(</span><span class="k">new</span> <span class="nf">ChunkCoord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="k">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 해당 위치의 블록 타입을 결정</span>
<span class="k">public</span> <span class="kt">byte</span> <span class="nf">GetBlockType</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Grass</span><span class="p">;</span> <span class="c1">// 1</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">Ground</span><span class="p">;</span> <span class="c1">// 2</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 Chunk 클래스의 <code class="language-plaintext highlighter-rouge">PopulateVoxelMap()</code> 메소드를 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">PopulateVoxelMap</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">y</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span><span class="p">;</span> <span class="n">y</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">z</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">;</span> <span class="n">z</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">voxelMap</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="p">=</span> <span class="n">world</span><span class="p">.</span><span class="nf">GetBlockType</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그런데 생성된 청크들의 내부를 들여다보면</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112816743-ac115300-90bc-11eb-96a6-f5a6acec235c.png" alt="image" /></p>

<p>이렇게 각각의 청크가 독립된 큐브 형태의 메시를 지니기 때문에, 결국 바깥에서 보이지 않는 부분도 그려지게 되는, 초기의 문제가 동일하게 발생하는 것을 확인할 수 있다.</p>

<p><br /></p>

<p>해결을 위해 우선 World 클래스 내에 메소드들을 작성 및 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c1">// World class</span>

<span class="c1">/// &lt;summary&gt; 해당 위치의 복셀이 월드 내에 있는지 검사 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="kt">bool</span> <span class="nf">IsBlockInWorld</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span>
        <span class="n">worldPos</span><span class="p">.</span><span class="n">x</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">worldPos</span><span class="p">.</span><span class="n">x</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInVoxels</span> <span class="p">&amp;&amp;</span>
        <span class="n">worldPos</span><span class="p">.</span><span class="n">z</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">worldPos</span><span class="p">.</span><span class="n">z</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInVoxels</span> <span class="p">&amp;&amp;</span>
        <span class="n">worldPos</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">worldPos</span><span class="p">.</span><span class="n">y</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 해당 위치의 블록 타입 검사&lt;/summary&gt;</span>
<span class="k">public</span> <span class="kt">byte</span> <span class="nf">GetBlockType</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(!</span><span class="nf">IsBlockInWorld</span><span class="p">(</span><span class="n">worldPos</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Grass</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">Ground</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 해당 위치의 블록이 단단한지 검사&lt;/summary&gt;</span>
<span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsBlockSolid</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">blockTypes</span><span class="p">[</span><span class="nf">GetBlockType</span><span class="p">(</span><span class="n">worldPos</span><span class="p">)].</span><span class="n">isSolid</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 청크 내부의 Solid 여부만 검사하던 Chunk.IsSolid() 메소드를 수정한다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>// Chunk class

private bool IsSolid(in Vector3 pos)
{
    return world.IsBlockSolid(pos + WorldPos);
}
</pre></td></tr></tbody></table></code></div></div>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112828193-5ba0f200-90ca-11eb-931a-cafbd439ca41.png" alt="image" /></p>

<p>이제 청크가 아니라 월드 단위로 내부와 외부를 판단하여 바깥 폴리곤만 그리게 된다.</p>

<p><br /></p>

<h2 id="시야-범위-내에서만-청크-생성"><strong>시야 범위 내에서만 청크 생성</strong></h2>

<p>현재로서는 월드 내의 모든 청크가 생성되고, 렌더링된다.</p>

<p>하지만 성능을 위해서는 지정된 플레이어 주변의 일정 영역 내에 존재하는 청크들만 생성되도록 해야 한다.</p>

<p>VoxelData 클래스에 새로운 필드를 추가하고, 기존의 필드값 하나를 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// VoxelData class</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">WorldSizeInChunks</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span> <span class="c1">// 5 -&gt; 100</span>

<span class="c1">// 시야 범위(청크 개수)</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">ViewDistanceInChunks</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‘시야’라는 것은 특정 대상을 중심으로 고려되어야 한다.</p>

<p>따라서 World 클래스에 다음 내용을 추가한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre></td><td class="rouge-code"><pre><span class="c1">// World class</span>

<span class="k">public</span> <span class="n">Transform</span> <span class="n">player</span><span class="p">;</span>
<span class="k">public</span> <span class="n">Vector3</span> <span class="n">spawnPosition</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt; 해당 청크 좌표가 월드 XZ 범위 내에 있는지 검사 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="kt">bool</span> <span class="nf">IsChunkPosInWorld</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInChunks</span> <span class="p">&amp;&amp;</span>
           <span class="n">z</span> <span class="p">&gt;=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">z</span> <span class="p">&lt;</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInChunks</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 월드 위치의 청크 좌표 리턴 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="n">ChunkCoord</span> <span class="nf">GetChunkCoordFromWorldPos</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">x</span> <span class="p">/</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">z</span> <span class="p">/</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ChunkCoord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">InitPositions</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">spawnPosition</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span>
        <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInVoxels</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">,</span>
        <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span><span class="p">,</span>
        <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInVoxels</span> <span class="p">*</span> <span class="m">0.5f</span>
    <span class="p">);</span>
    <span class="n">player</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">spawnPosition</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">GenerateWorld</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">center</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInChunks</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">viewMin</span> <span class="p">=</span> <span class="n">center</span> <span class="p">-</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ViewDistanceInChunks</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">viewMax</span> <span class="p">=</span> <span class="n">center</span> <span class="p">+</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ViewDistanceInChunks</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="n">viewMin</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">viewMax</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="n">viewMin</span><span class="p">;</span> <span class="n">z</span> <span class="p">&lt;</span> <span class="n">viewMax</span><span class="p">;</span> <span class="n">z</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="nf">CreateNewChunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 시야범위 내의 청크 생성 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">UpdateChunksInViewRange</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ChunkCoord</span> <span class="n">coord</span> <span class="p">=</span> <span class="nf">GetChunkCoordFromWorldPos</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">viewDist</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ViewDistanceInChunks</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span> <span class="n">viewMin</span> <span class="p">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">viewDist</span><span class="p">,</span> <span class="n">coord</span><span class="p">.</span><span class="n">z</span> <span class="p">-</span> <span class="n">viewDist</span><span class="p">);</span>
    <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span> <span class="n">viewMax</span> <span class="p">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">viewDist</span><span class="p">,</span> <span class="n">coord</span><span class="p">.</span><span class="n">z</span> <span class="p">+</span> <span class="n">viewDist</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="n">viewMin</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">viewMax</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="n">viewMin</span><span class="p">.</span><span class="n">z</span><span class="p">;</span> <span class="n">z</span> <span class="p">&lt;</span> <span class="n">viewMax</span><span class="p">.</span><span class="n">z</span><span class="p">;</span> <span class="n">z</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="c1">// 청크 좌표가 월드 범위 내에 있는지 검사</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">IsChunkPosInWorld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>

            <span class="c1">// 시야 범위 내에 청크가 생성되지 않은 영역이 있을 경우, 새로 생성</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="nf">CreateNewChunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">InitPositions</span><span class="p">();</span>
    <span class="nf">GenerateWorld</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">UpdateChunksInViewRange</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>이제 플레이어가 이동했을 때 시야 범위가 닿는 곳에 청크가 존재하지 않으면 새롭게 생성한다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112835539-606aa380-90d4-11eb-9d42-24251335693a.gif" alt="2021_0329_VoxelSystem_1" /></p>

<p><br /></p>

<h2 id="시야-범위-내에서만-청크-유지"><strong>시야 범위 내에서만 청크 유지</strong></h2>

<p>플레이어의 시야 범위를 벗어나는 범위의 청크는 파괴하거나 비활성화할 필요가 있다.</p>

<p>생성/파괴는 비싼 작업이므로, 오브젝트 풀링하듯 시야 범위를 벗어나는 청크들은 비활성화하고, 시야 범위 내에 들어온 청크들만 실시간으로 활성화하도록 한다.</p>

<p>우선 두 개의 리스트를 만든다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c1">// World class</span>

<span class="c1">// 이전 프레임에 활성화 되었던 청크 목록</span>
<span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Chunk</span><span class="p">&gt;</span> <span class="n">prevActiveChunkList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Chunk</span><span class="p">&gt;();</span>

<span class="c1">// 현재 프레임에 활성화된 청크 목록</span>
<span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Chunk</span><span class="p">&gt;</span> <span class="n">currentActiveChunkList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Chunk</span><span class="p">&gt;();</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 UpdateChunksInViewRange() 메소드를 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt; 시야범위 내의 청크들만 유지 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">UpdateChunksInViewRange</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ChunkCoord</span> <span class="n">coord</span> <span class="p">=</span> <span class="nf">GetChunkCoordFromWorldPos</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">viewDist</span> <span class="p">=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ViewDistanceInChunks</span><span class="p">;</span>
    <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span> <span class="n">viewMin</span> <span class="p">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">viewDist</span><span class="p">,</span> <span class="n">coord</span><span class="p">.</span><span class="n">z</span> <span class="p">-</span> <span class="n">viewDist</span><span class="p">);</span>
    <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span> <span class="n">viewMax</span> <span class="p">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">viewDist</span><span class="p">,</span> <span class="n">coord</span><span class="p">.</span><span class="n">z</span> <span class="p">+</span> <span class="n">viewDist</span><span class="p">);</span>

    <span class="c1">// 활성 목록 : 현재 -&gt; 이전으로 이동</span>
    <span class="n">prevActiveChunkList</span> <span class="p">=</span> <span class="n">currentActiveChunkList</span><span class="p">;</span>
    <span class="n">currentActiveChunkList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Chunk</span><span class="p">&gt;();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="n">viewMin</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="p">&lt;</span> <span class="n">viewMax</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="n">x</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">z</span> <span class="p">=</span> <span class="n">viewMin</span><span class="p">.</span><span class="n">z</span><span class="p">;</span> <span class="n">z</span> <span class="p">&lt;</span> <span class="n">viewMax</span><span class="p">.</span><span class="n">z</span><span class="p">;</span> <span class="n">z</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="c1">// 청크 좌표가 월드 범위 내에 있는지 검사</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">IsChunkPosInWorld</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>

            <span class="n">Chunk</span> <span class="n">currentChunk</span> <span class="p">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">];</span>

            <span class="c1">// 시야 범위 내에 청크가 생성되지 않은 영역이 있을 경우, 새로 생성</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">CreateNewChunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
                <span class="n">currentChunk</span> <span class="p">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">];</span> <span class="c1">// 참조 갱신</span>
            <span class="p">}</span>
            <span class="c1">// 비활성화 되어있던 경우에는 활성화</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">].</span><span class="n">IsActive</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">chunks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">].</span><span class="n">IsActive</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// 현재 활성 목록에 추가</span>
            <span class="n">currentActiveChunkList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">currentChunk</span><span class="p">);</span>

            <span class="c1">// 이전 활성 목록에서 제거</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prevActiveChunkList</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">currentChunk</span><span class="p">))</span>
                <span class="n">prevActiveChunkList</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">currentChunk</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 차집합으로 남은 청크들 비활성화</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">chunk</span> <span class="k">in</span> <span class="n">prevActiveChunkList</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">chunk</span><span class="p">.</span><span class="n">IsActive</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>이전 프레임에 활성화되었던 청크들이 현재 프레임에는 활성화되지 않은 경우,</p>

<p>해당 청크들을 비활성화 해주기만 하면 된다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/112843745-e3442c00-90dd-11eb-9a2e-d1fd99e09a94.gif" alt="2021_0329_VoxelSystem_2" /></p>

<p>그러면 이렇게 시야 범위 내에서만 청크들을 활성화 상태로 유지할 수 있다.</p>

<p><br /></p>

<h2 id="최적화">최적화</h2>

<p>현재 Update()에서 매 프레임마다 시야 범위를 갱신해주고 있는데,</p>

<p>이를 두 가지 방법으로 최적화 해줄 수 있다.</p>

<ol>
  <li>
    <p>플레이어가 다른 청크로 이동했을 때만 갱신한다.</p>
  </li>
  <li>
    <p>Update()가 아니라 코루틴에서 더 긴 주기마다 갱신한다.</p>
  </li>
</ol>

<p>여기서는 일단 1번 방식만 이용하도록 한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="c1">// World.cs</span>

<span class="c1">// 플레이어의 이전 프레임 위치</span>
<span class="k">private</span> <span class="n">ChunkCoord</span> <span class="n">prevPlayerCoord</span><span class="p">;</span>

<span class="c1">// 플레이어의 현재 프레임 위치</span>
<span class="k">private</span> <span class="n">ChunkCoord</span> <span class="n">currentPlayerCoord</span><span class="p">;</span>


<span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">InitPositions</span><span class="p">();</span>
    <span class="c1">//GenerateWorld(); // 필요 X (UpdateChunksInViewRange()에서 수행)</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">currentPlayerCoord</span> <span class="p">=</span> <span class="nf">GetChunkCoordFromWorldPos</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>

    <span class="c1">// 플레이어가 청크 위치를 이동한 경우, 시야 범위 갱신</span>
    <span class="k">if</span><span class="p">(!</span><span class="n">prevPlayerCoord</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">currentPlayerCoord</span><span class="p">))</span>
        <span class="nf">UpdateChunksInViewRange</span><span class="p">();</span>

    <span class="n">prevPlayerCoord</span> <span class="p">=</span> <span class="n">currentPlayerCoord</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// 수정</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">InitPositions</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">spawnPosition</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span>
        <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInVoxels</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">,</span>
        <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span><span class="p">,</span>
        <span class="n">VoxelData</span><span class="p">.</span><span class="n">WorldSizeInVoxels</span> <span class="p">*</span> <span class="m">0.5f</span>
    <span class="p">);</span>
    <span class="n">player</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">spawnPosition</span><span class="p">;</span>

    <span class="n">prevPlayerCoord</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ChunkCoord</span><span class="p">(-</span><span class="m">1</span><span class="p">,</span> <span class="p">-</span><span class="m">1</span><span class="p">);</span>
    <span class="n">currentPlayerCoord</span> <span class="p">=</span> <span class="nf">GetChunkCoordFromWorldPos</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h1 id="5-지형-만들기">5. 지형 만들기</h1>
<hr />

<h2 id="펄린-노이즈"><strong>펄린 노이즈</strong></h2>

<p>랜덤랜덤한 지형을 만들기 위해서 펄린 노이즈를 이용한다.</p>

<p>펄린 노이즈를 계산할 정적 클래스를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1">// Noise.cs</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Noise</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">float</span> <span class="nf">Get2DPerlin</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector2</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 각자 0.1을 더해주는 이유 : 버그가 있어서</span>
        <span class="k">return</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">PerlinNoise</span> 
        <span class="p">(</span>
            <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="m">0.1f</span><span class="p">)</span> <span class="p">/</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span> <span class="p">*</span> <span class="n">scale</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span>
            <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="m">0.1f</span><span class="p">)</span> <span class="p">/</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkWidth</span> <span class="p">*</span> <span class="n">scale</span> <span class="p">+</span> <span class="n">offset</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 <code class="language-plaintext highlighter-rouge">World</code> 클래스에서 이를 이용해 표면을 2가지 블록으로 그려본다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="c1">// World class</span>

<span class="p">[</span><span class="n">Space</span><span class="p">]</span>
<span class="k">public</span> <span class="kt">int</span> <span class="n">seed</span><span class="p">;</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Random</span><span class="p">.</span><span class="nf">InitState</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>

    <span class="nf">InitPositions</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 해당 위치의 블록 타입 검사&lt;/summary&gt;</span>
<span class="k">public</span> <span class="kt">byte</span> <span class="nf">GetBlockType</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 월드 범위 밖이면 공기</span>
    <span class="k">if</span><span class="p">(!</span><span class="nf">IsBlockInWorld</span><span class="p">(</span><span class="n">worldPos</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>
    
    <span class="c1">// 높이 0까지는 기반암</span>
    <span class="k">if</span><span class="p">(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span> <span class="p">&lt;</span> <span class="m">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bedrock</span><span class="p">;</span>

    <span class="c1">// 맨 위 표면</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;=</span> <span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">noise</span> <span class="p">=</span> <span class="n">Noise</span><span class="p">.</span><span class="nf">Get2DPerlin</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">worldPos</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="m">0f</span><span class="p">,</span> <span class="m">0.1f</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">noise</span> <span class="p">&lt;</span> <span class="m">0.5f</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Grass</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">Sand</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 표면 ~ 기반암 사이 : 돌멩이</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="n">Stone</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/113118519-831ec880-924a-11eb-88d8-75d498118900.gif" alt="2021_0331_Voxel_Noise" /></p>

<p><br /></p>

<h2 id="3d-지형-그리기"><strong>3D 지형 그리기</strong></h2>

<p>펄린 노이즈로 얻어낸 값을 높이로 사용하여</p>

<p>청크에서 y축 높이가 펄린 노이즈 값과 일치하는 좌표에는 표면을 그리고,</p>

<p>더 높은 경우에는 비워놓고(Air),</p>

<p>더 낮은 경우에는 지반을 그리는 형태로 수정한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="c1">// World class</span>

<span class="k">public</span> <span class="kt">byte</span> <span class="nf">GetBlockType</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// NOTE : 모든 값은 0보다 크거나 같기 때문에 Mathf.FloorToInt() 할 필요 없음</span>

    <span class="kt">int</span> <span class="n">yPos</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="cm">/* -----------------------------------------------
                        Immutable Pass
    ----------------------------------------------- */</span>
    <span class="c1">// 월드 밖 : 공기</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">IsBlockInWorld</span><span class="p">(</span><span class="n">worldPos</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>
            
    <span class="c1">// 높이 0은 기반암</span>
    <span class="k">if</span><span class="p">(</span><span class="n">yPos</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bedrock</span><span class="p">;</span>

    <span class="cm">/* -----------------------------------------------
                    Basic Terrain Pass
    ----------------------------------------------- */</span>
    <span class="c1">// noise : 0.0 ~ 1.0</span>
    <span class="kt">float</span> <span class="n">noise</span> <span class="p">=</span> <span class="n">Noise</span><span class="p">.</span><span class="nf">Get2DPerlin</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">worldPos</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="m">500f</span><span class="p">,</span> <span class="m">0.25f</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">terrainHeight</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">VoxelData</span><span class="p">.</span><span class="n">ChunkHeight</span> <span class="p">*</span> <span class="n">noise</span><span class="p">);</span>

    <span class="c1">// terrainHeight : 0 ~ VoxelData.ChunkHeight(15)</span>

    <span class="c1">// 지면</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">yPos</span> <span class="p">==</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Grass</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 땅속</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">yPos</span> <span class="p">&lt;</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Stone</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/113122024-33da9700-924e-11eb-800e-e0abd1c580ca.gif" alt="2021_0331_Voxel_Noise2" /></p>

<p><br /></p>

<h2 id="biome-정의"><strong>Biome 정의</strong></h2>

<p>지정한 환경 데이터에 따라 지형 분포를 다르게 할 수 있도록, Biome을 정의하고 이를 World 클래스에서 사용하도록 한다.</p>

<p>Biome은 생태계 정도로 해석하면 될 것 같다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt; 지형 분포 데이터 &lt;/summary&gt;</span>
<span class="p">[</span><span class="nf">CreateAssetMenu</span><span class="p">(</span><span class="n">fileName</span> <span class="p">=</span> <span class="s">"BiomeData"</span><span class="p">,</span> <span class="n">menuName</span> <span class="p">=</span> <span class="s">"Voxel System/Biome Attribute"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">BiomeData</span> <span class="p">:</span> <span class="n">ScriptableObject</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">biomeName</span><span class="p">;</span>

    <span class="c1">// 이 값 이하의 높이는 모두 solid</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">solidGroundHeight</span><span class="p">;</span>

    <span class="c1">// solidGroundHeight로부터 증가할 수 있는 최대 높이값</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">terrainHeightRange</span><span class="p">;</span>

    <span class="k">public</span> <span class="kt">float</span> <span class="n">terrainScale</span><span class="p">;</span>

    <span class="cm">/*
        예시

        solidGroundHeight  = 40;
        terrainHeightRange = 30;

        =&gt; 지형의 최소 높이 : 40, 지형의 최대 높이(고지) : 70
    */</span>
<span class="p">}</span>


<span class="c1">// VoxelData class</span>

<span class="c1">// 청크 내의 X, Z 성분 복셀 개수</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">ChunkWidth</span> <span class="p">=</span> <span class="m">16</span><span class="p">;</span>

<span class="c1">// 청크 내의 Y 성분 복셀 개수</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">ChunkHeight</span> <span class="p">=</span> <span class="m">128</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt; 월드의 각 X, Z 성분 청크 개수 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">WorldSizeInChunks</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>


<span class="c1">// World class</span>

<span class="k">public</span> <span class="n">BiomeData</span> <span class="n">biome</span><span class="p">;</span>

<span class="k">public</span> <span class="kt">byte</span> <span class="nf">GetBlockType</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">yPos</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="cm">/* -----------------------------------------------
                        Immutable Pass
    ----------------------------------------------- */</span>
    <span class="c1">// 월드 밖 : 공기</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">IsBlockInWorld</span><span class="p">(</span><span class="n">worldPos</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>
            
    <span class="c1">// 높이 0은 기반암</span>
    <span class="k">if</span><span class="p">(</span><span class="n">yPos</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bedrock</span><span class="p">;</span>

    <span class="cm">/* -----------------------------------------------
                    Basic Terrain Pass
    ----------------------------------------------- */</span>
    <span class="c1">// noise : 0.0 ~ 1.0</span>
    <span class="kt">float</span> <span class="n">noise</span> <span class="p">=</span> <span class="n">Noise</span><span class="p">.</span><span class="nf">Get2DPerlin</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">worldPos</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="m">0f</span><span class="p">,</span> <span class="n">biome</span><span class="p">.</span><span class="n">terrainScale</span><span class="p">);</span>

    <span class="c1">// 지형 높이 : solidGroundHeight ~ (solidGroundHeight + terrainHeightRange)</span>
    <span class="kt">float</span> <span class="n">terrainHeight</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">biome</span><span class="p">.</span><span class="n">terrainHeightRange</span> <span class="p">*</span> <span class="n">noise</span><span class="p">)</span> <span class="p">+</span> <span class="n">biome</span><span class="p">.</span><span class="n">solidGroundHeight</span><span class="p">;</span>


    <span class="c1">// 공기</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">yPos</span> <span class="p">&gt;</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 지면</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">yPos</span> <span class="p">==</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Grass</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 얕은 땅속</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">terrainHeight</span> <span class="p">-</span> <span class="m">4</span> <span class="p">&lt;</span> <span class="n">yPos</span> <span class="p">&amp;&amp;</span> <span class="n">yPos</span> <span class="p">&lt;</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Dirt</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 깊은 땅속</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Stone</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/113137733-e2d39e80-925f-11eb-87f5-3033910e5de6.png" alt="image" /></p>

<p>biome은 기본 값으로 SolidGroundHeight, terrainHeightRange는 42, terrainScale은 0.25로 지정한 상태.</p>

<p><br /></p>

<h2 id="3d-펄린-노이즈"><strong>3D 펄린 노이즈</strong></h2>

<p>이제 3D 펄린 노이즈를 구현하고, 이를 이용한다.</p>

<p>3D 노이즈를 이용하면 동굴 등 훨씬 다양한 지형들을 그려낼 수 있다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="c1">// Noise class</span>

<span class="c1">// Return : isSolid</span>
<span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">Get3DPerlin</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">position</span><span class="p">,</span> <span class="kt">float</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">,</span> <span class="kt">float</span> <span class="n">threshold</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// https://www.youtube.com/watch?v=Aga0TBJkchM&amp;ab_channel=Carlpilot</span>

    <span class="kt">float</span> <span class="n">x</span> <span class="p">=</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">offset</span> <span class="p">+</span> <span class="m">0.1f</span><span class="p">)</span> <span class="p">*</span> <span class="n">scale</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">y</span> <span class="p">=</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">offset</span> <span class="p">+</span> <span class="m">0.1f</span><span class="p">)</span> <span class="p">*</span> <span class="n">scale</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">z</span> <span class="p">=</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="p">+</span> <span class="n">offset</span> <span class="p">+</span> <span class="m">0.1f</span><span class="p">)</span> <span class="p">*</span> <span class="n">scale</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">AB</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">PerlinNoise</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">BC</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">PerlinNoise</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">CA</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">PerlinNoise</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">BA</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">PerlinNoise</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">CB</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">PerlinNoise</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">AC</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">PerlinNoise</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">AB</span> <span class="p">+</span> <span class="n">BC</span> <span class="p">+</span> <span class="n">CA</span> <span class="p">+</span> <span class="n">BA</span> <span class="p">+</span> <span class="n">CB</span> <span class="p">+</span> <span class="n">AC</span><span class="p">)</span> <span class="p">/</span> <span class="m">6f</span> <span class="p">&gt;</span> <span class="n">threshold</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 BiomeData에 Lode 배열을 추가한다.</p>

<p>이 배열의 데이터들은 광맥 또는 동굴을 의미하여,</p>

<p>TerrainPass에서 그린 지형을 2차적으로 3D 노이즈를 통해 얻은 값으로 수정하고</p>

<p>지형의 사이사이에 광맥 또는 동굴 지형을 추가해줄 수 있다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
</pre></td><td class="rouge-code"><pre><span class="c1">// BiomeData class</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">BiomeData</span> <span class="p">:</span> <span class="n">ScriptableObject</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="n">Lode</span><span class="p">[]</span> <span class="n">lodes</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 광맥 &lt;/summary&gt;</span>
<span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Lode</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">loadName</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">byte</span> <span class="n">blockID</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">minHeight</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">maxHeight</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">threshold</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">noiseOffset</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// World class</span>

<span class="k">public</span> <span class="kt">byte</span> <span class="nf">GetBlockType</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldPos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">yPos</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="kt">byte</span> <span class="n">blockType</span> <span class="p">=</span> <span class="n">Air</span><span class="p">;</span>

    <span class="cm">/* --------------------------------------------- *
     *                Immutable Pass                 *
     * --------------------------------------------- */</span>
    <span class="c1">// 월드 밖 : 공기</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">IsBlockInWorld</span><span class="p">(</span><span class="n">worldPos</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>
            
    <span class="c1">// 높이 0은 기반암</span>
    <span class="k">if</span><span class="p">(</span><span class="n">yPos</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bedrock</span><span class="p">;</span>

    <span class="cm">/* --------------------------------------------- *
     *              Basic Terrain Pass               *
     * --------------------------------------------- */</span>
    <span class="c1">// noise : 0.0 ~ 1.0</span>
    <span class="kt">float</span> <span class="n">noise</span> <span class="p">=</span> <span class="n">Noise</span><span class="p">.</span><span class="nf">Get2DPerlin</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector2</span><span class="p">(</span><span class="n">worldPos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">worldPos</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="m">0f</span><span class="p">,</span> <span class="n">biome</span><span class="p">.</span><span class="n">terrainScale</span><span class="p">);</span>

    <span class="c1">// 지형 높이 : solidGroundHeight ~ (solidGroundHeight + terrainHeightRange)</span>
    <span class="kt">float</span> <span class="n">terrainHeight</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">biome</span><span class="p">.</span><span class="n">terrainHeightRange</span> <span class="p">*</span> <span class="n">noise</span><span class="p">)</span> <span class="p">+</span> <span class="n">biome</span><span class="p">.</span><span class="n">solidGroundHeight</span><span class="p">;</span>


    <span class="c1">// 공기</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">yPos</span> <span class="p">&gt;</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Air</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 지면</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">yPos</span> <span class="p">==</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">blockType</span> <span class="p">=</span> <span class="n">Grass</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 얕은 땅속</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">terrainHeight</span> <span class="p">-</span> <span class="m">4</span> <span class="p">&lt;</span> <span class="n">yPos</span> <span class="p">&amp;&amp;</span> <span class="n">yPos</span> <span class="p">&lt;</span> <span class="n">terrainHeight</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">blockType</span> <span class="p">=</span> <span class="n">Dirt</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 깊은 땅속</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">blockType</span> <span class="p">=</span> <span class="n">Stone</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* --------------------------------------------- *
     *              Second Terrain Pass              *
     * --------------------------------------------- */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">blockType</span> <span class="p">==</span> <span class="n">Stone</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">lode</span> <span class="k">in</span> <span class="n">biome</span><span class="p">.</span><span class="n">lodes</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lode</span><span class="p">.</span><span class="n">minHeight</span> <span class="p">&lt;</span> <span class="n">yPos</span> <span class="p">&amp;&amp;</span> <span class="n">yPos</span> <span class="p">&lt;</span> <span class="n">lode</span><span class="p">.</span><span class="n">maxHeight</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Noise</span><span class="p">.</span><span class="nf">Get3DPerlin</span><span class="p">(</span><span class="n">worldPos</span><span class="p">,</span> <span class="n">lode</span><span class="p">.</span><span class="n">noiseOffset</span><span class="p">,</span> <span class="n">lode</span><span class="p">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">lode</span><span class="p">.</span><span class="n">threshold</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">blockType</span> <span class="p">=</span> <span class="n">lode</span><span class="p">.</span><span class="n">blockID</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">blockType</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/113143261-e61e5880-9266-11eb-88ec-cbe28377aae3.png" alt="image" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/113143213-dc94f080-9266-11eb-995d-741fde80bf9d.png" alt="image" /></p>

<p><br /></p>

<h1 id="6-캐릭터-컨트롤러-만들기">6. 캐릭터 컨트롤러 만들기</h1>
<hr />

<p>만약 모든 청크에 Mesh Collider를 사용한다면, 메시가 수정될 때마다 다시 전체를 계산해서 그려져야 하므로 굉장히 비싼 연산이 될 것이다.</p>

<p>따라서 유니티의 물리 엔진을 사용하지 않고, 복셀 월드 내에서만 사용될 수 있는 물리 계산을 직접 하여 캐릭터 컨트롤러를 구현할 것이다.</p>

<p><br /></p>

<h2 id="초기-세팅"><strong>초기 세팅</strong></h2>

<p>(0, 0, 0)에 위치한 게임오브젝트를 만들고 이름을 [Player]로 변경한다.</p>

<p>그리고 카메라 게임오브젝트를 [Player]의 자식으로 넣고 위치를 (0, 1.8, 0)으로 변경한다.</p>

<p>[World] 게임오브젝트에 있는 <code class="language-plaintext highlighter-rouge">World</code> 컴포넌트의 <code class="language-plaintext highlighter-rouge">Player</code> 필드에 [Player]를 넣어준다.</p>

<p>새로운 스크립트를 생성하고 이름을 <code class="language-plaintext highlighter-rouge">Player</code>로 지정한다.</p>

<p><br /></p>

<h2 id="player-클래스-작성"><strong>Player 클래스 작성</strong></h2>

<p>간단히 키보드에 의한 이동, 마우스에 의한 회전을 할 수 있으며 중력이 적용되는 플레이어 클래스를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="cm">/***********************************************************************
    *                               Inspector Fields
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="n">World</span> <span class="n">world</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">10f</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="kt">float</span> <span class="n">walkSpeed</span> <span class="p">=</span> <span class="m">5f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(-</span><span class="m">20</span><span class="p">,</span> <span class="p">-</span><span class="m">9.8f</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="kt">float</span> <span class="n">gravity</span> <span class="p">=</span> <span class="p">-</span><span class="m">9.8f</span><span class="p">;</span>

    <span class="err">#</span><span class="n">endregion</span>
    <span class="cm">/***********************************************************************
    *                               Private Reference Fields
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="k">private</span> <span class="n">Transform</span> <span class="n">camTr</span><span class="p">;</span>

    <span class="err">#</span><span class="n">endregion</span>
    <span class="cm">/***********************************************************************
    *                               Private Fields
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">h</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">v</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">mouseX</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">mouseY</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">deltaTime</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">velocity</span><span class="p">;</span>

    <span class="err">#</span><span class="n">endregion</span>
    <span class="cm">/***********************************************************************
    *                               Unity Events
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Init</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">deltaTime</span> <span class="p">=</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>
        <span class="nf">GetPlayerInputs</span><span class="p">();</span>
        <span class="nf">CalculateVelocity</span><span class="p">();</span>
        <span class="nf">MoveAndRotate</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="err">#</span><span class="n">endregion</span>
    <span class="cm">/***********************************************************************
    *                               Private Methods
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">cam</span> <span class="p">=</span> <span class="n">GetComponentInChildren</span><span class="p">&lt;</span><span class="n">Camera</span><span class="p">&gt;();</span>
        <span class="n">camTr</span> <span class="p">=</span> <span class="n">cam</span><span class="p">.</span><span class="n">transform</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">GetPlayerInputs</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">h</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="nf">GetAxisRaw</span><span class="p">(</span><span class="s">"Horizontal"</span><span class="p">);</span>
        <span class="n">v</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="nf">GetAxisRaw</span><span class="p">(</span><span class="s">"Vertical"</span><span class="p">);</span>
        <span class="n">mouseX</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="nf">GetAxis</span><span class="p">(</span><span class="s">"Mouse X"</span><span class="p">);</span>
        <span class="n">mouseY</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="nf">GetAxis</span><span class="p">(</span><span class="s">"Mouse Y"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">CalculateVelocity</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">velocity</span> <span class="p">=</span> <span class="p">((</span><span class="n">transform</span><span class="p">.</span><span class="n">forward</span> <span class="p">*</span> <span class="n">v</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">right</span> <span class="p">*</span> <span class="n">h</span><span class="p">))</span> <span class="p">*</span> <span class="n">deltaTime</span> <span class="p">*</span> <span class="n">walkSpeed</span><span class="p">;</span>
        <span class="n">velocity</span> <span class="p">+=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="nf">CalculateDownSpeedAndSetGroundState</span><span class="p">(</span><span class="n">gravity</span> <span class="p">*</span> <span class="n">deltaTime</span><span class="p">);</span> <span class="c1">// 중력 적용</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">MoveAndRotate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Rotate</span>
        <span class="n">transform</span><span class="p">.</span><span class="nf">Rotate</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="n">mouseX</span><span class="p">);</span>
        <span class="n">camTr</span><span class="p">.</span><span class="nf">Rotate</span><span class="p">(</span><span class="n">Vector3</span><span class="p">.</span><span class="n">right</span> <span class="p">*</span> <span class="p">-</span><span class="n">mouseY</span><span class="p">);</span>

        <span class="c1">// Move</span>
        <span class="n">transform</span><span class="p">.</span><span class="nf">Translate</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">Space</span><span class="p">.</span><span class="n">World</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="err">#</span><span class="n">endregion</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>이 상태에서는 이동 및 회전을 할 수 있지만 바닥을 인식할 수 없어 무한정 아래로 떨어지게 된다.</p>

<p><br /></p>

<h2 id="바닥-인식하기-y방향-충돌-구현"><strong>바닥 인식하기(-Y방향 충돌 구현)</strong></h2>

<p>다음 필드들을 추가한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="kt">float</span> <span class="n">playerWidth</span> <span class="p">=</span> <span class="m">0.3f</span><span class="p">;</span>       <span class="c1">// 플레이어의 XZ 반지름</span>
<span class="k">private</span> <span class="kt">float</span> <span class="n">boundsTolerance</span> <span class="p">=</span> <span class="m">0.3f</span><span class="p">;</span>
<span class="k">private</span> <span class="kt">float</span> <span class="n">verticalMomentum</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>

<span class="k">private</span> <span class="kt">bool</span> <span class="n">isGrounded</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="k">private</span> <span class="kt">bool</span> <span class="n">isJumping</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="k">private</span> <span class="kt">bool</span> <span class="n">isRunning</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="k">private</span> <span class="kt">bool</span> <span class="n">jumpRequested</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 바닥을 인식하도록 메소드를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt; -Y 방향의 속력을 계산하고 isGrounded 초기화 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="kt">float</span> <span class="nf">CalculateDownSpeedAndSetGroundState</span><span class="p">(</span><span class="kt">float</span> <span class="n">yVelocity</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// playerWidth * 2를 변의 길이로 하는 XZ 평면 정사각형의 네 꼭짓점에서 하단으로 grounded 체크</span>
    <span class="c1">// gounded 체크가 플레이어 회전의 영향을 받지 않도록, transform 로컬벡터가 아니라 월드벡터 기준으로 검사</span>
    <span class="c1">// 즉, 플레이어가 회전해도 큐브 모양의 콜라이더가 회전하지 않는 효과</span>

    <span class="n">Vector3</span> <span class="n">pos</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>

    <span class="n">isGrounded</span> <span class="p">=</span> 
        <span class="n">world</span><span class="p">.</span><span class="nf">IsBlockSolid</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">playerWidth</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">yVelocity</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">z</span> <span class="p">-</span> <span class="n">playerWidth</span><span class="p">))</span> <span class="p">||</span>
        <span class="n">world</span><span class="p">.</span><span class="nf">IsBlockSolid</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">playerWidth</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">yVelocity</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">z</span> <span class="p">-</span> <span class="n">playerWidth</span><span class="p">))</span> <span class="p">||</span>
        <span class="n">world</span><span class="p">.</span><span class="nf">IsBlockSolid</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">playerWidth</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">yVelocity</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">z</span> <span class="p">+</span> <span class="n">playerWidth</span><span class="p">))</span> <span class="p">||</span>
        <span class="n">world</span><span class="p">.</span><span class="nf">IsBlockSolid</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="p">-</span> <span class="n">playerWidth</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">yVelocity</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">z</span> <span class="p">+</span> <span class="n">playerWidth</span><span class="p">));</span>

    <span class="k">return</span> <span class="n">isGrounded</span> <span class="p">?</span> <span class="m">0</span> <span class="p">:</span> <span class="n">yVelocity</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">CalculateVelocity</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">velocity</span> <span class="p">=</span> <span class="p">((</span><span class="n">transform</span><span class="p">.</span><span class="n">forward</span> <span class="p">*</span> <span class="n">v</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">right</span> <span class="p">*</span> <span class="n">h</span><span class="p">))</span> <span class="p">*</span> <span class="n">deltaTime</span> <span class="p">*</span> <span class="n">walkSpeed</span><span class="p">;</span>
    <span class="n">velocity</span> <span class="p">+=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="nf">CalculateDownSpeedAndSetGroundState</span><span class="p">(</span><span class="n">gravity</span> <span class="p">*</span> <span class="n">deltaTime</span><span class="p">);</span> <span class="c1">// 중력 적용, 바닥 인식</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>원리는 간단하다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/113419545-9f656580-9402-11eb-8be0-97b42b68dc87.png" alt="image" /></p>

<p>이렇게 캐릭터의 콜라이더 하단 사각형의 각 꼭짓점에서 이번 프레임에 이동할 Y축 거리를 각각 우선 이동하여, 해당 위치 중 하나라도 Solid이면 Y축 이동속도를 0으로 만드는 것이다.</p>

<p><br /></p>

<h2 id="xz평면-충돌-구현"><strong>XZ평면 충돌 구현</strong></h2>

<p>콜라이더의 XZ 평면 사각형이 캐릭터를 따라 항상 회전하도록 구현하려면 선분 교차 알고리즘을 이용해야 하며,</p>

<p>벽에 닿은 상태에서 캐릭터가 회전하면 콜라이더가 지형과 겹쳐버리기 때문에 2차적인 처리가 필요해진다.</p>

<p>따라서 다른 대안으로는 콜라이더를 원형으로 구현하거나 회전하지 않는 사각형으로 구현하는 방법이 있다.</p>

<p>이미 -Y 충돌 구현에서 회전하지 않는 사각형으로 콜라이더의 바닥면을 구현했기 때문에, XZ평면 충돌 역시 회전하지 않는 사각형으로 구현한다.</p>

<p>그리고 충돌 검사 중 가장 단순하고 저렴하다는 장점이 있다.</p>

<p>TODO : 튜토리얼 06 - 44:36 ==&gt; position + a 로 바로 더해서 검사하는 점, +y(0), +y(1) 밖에 검사 안한다는 점 수정해야 함 ….. 너무 단순하고 허점 많은 검사..</p>

<p>검사하려는 XZ 4방향으로 예를 들어 +X 방향이면 ZY 평면의 네 꼭지점에서 +X 방향으로 전진시켜, 교차할 수 있는 최대 4개(Z는 0.6 길이이므로 최대 2개 교차 * Y는 1.999 길이로  최대 2개 교차(하단 시작점 좌표가 .0이므로))의 큐브 Solid 상태 검사하여 4개 중 하나라도 Solid이면 X방향 속도 0으로 만들기</p>

<p>TODO : 콜라이더 육면체 기즈모로 표시</p>

<p><br /></p>

<p><br /></p>

<h1 id="source-code">Source Code</h1>
<hr />
<ul>
  <li><a href="https://github.com/rito15/UnityStudy2">https://github.com/rito15/UnityStudy2</a></li>
</ul>

<p><br /></p>

<h1 id="references">References</h1>
<hr />
<ul>
  <li><a href="https://www.youtube.com/playlist?list=PLVsTSlfj0qsWEJ-5eMtXsYp03Y9yF1dEn">https://www.youtube.com/playlist?list=PLVsTSlfj0qsWEJ-5eMtXsYp03Y9yF1dEn</a></li>
</ul>



      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/unity/'>Unity</a>,
            <a href='/categories/unity-study/'>Unity Study</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/unity/"
            class="post-tag no-text-decoration" >unity</a>
          
          <a href="/tags/csharp/"
            class="post-tag no-text-decoration" >csharp</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet

 v2.1
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=유니티 - Voxel System(마인크래프트 구현하기) [TODO] - Rito15&url=https://rito15.github.io/posts/unity-study-voxel/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=유니티 - Voxel System(마인크래프트 구현하기) [TODO] - Rito15&u=https://rito15.github.io/posts/unity-study-voxel/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=유니티 - Voxel System(마인크래프트 구현하기) [TODO] - Rito15&url=https://rito15.github.io/posts/unity-study-voxel/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/unity-update-vs-coroutine-every-frame/">유니티 - 매 프레임 처리 성능 테스트 - Update() vs 코루틴</a></li>
      
        
        
        
        <li><a href="/posts/memo-git-command-1-basic/">Git - 명령어 - 1. 기본</a></li>
      
        
        
        
        <li><a href="/posts/install-docker-on-windows-10/">Docker - 2. Windows 10 환경에서 도커 설치하기</a></li>
      
        
        
        
        <li><a href="/posts/unity-memo-show-property-on-inspector/">유니티 - 인스펙터에 프로퍼티 표시하기</a></li>
      
        
        
        
        <li><a href="/posts/unity-shader-receive-and-cast-shadow/">유니티 - Vert/Frag 쉐이더에서 Receive Shadow, Cast Shadow 구현하기</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/editor/">editor</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/memo/">memo</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/amplify/">amplify</a>
      
        
        <a class="post-tag" href="/tags/thread/">thread</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.

 v2.0
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/unity-serialize-tree-object/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Sep  6, 2021
  

  <i class="unloaded">2021-09-06T23:23:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>유니티 - 트리 구조 데이터 직렬화하기</h3>
            <div class="text-muted small">
              <p>
                





                트리(Tree) 자료구조


1
2
3
4
class TreeNode
{
    public TreeNode[] children;
}


위와 같이 자기 타입의 배열 또는 컬렉션을 필드로 갖는 구조를 트리 자료구조라고 한다.

자식 및 하위 노드들을 순회하기 위해 재귀적 호출을 많이 사용한다.





직렬화(Serialization)


데이터를 저...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/unity-million-dust-simulation/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Sep 27, 2021
  

  <i class="unloaded">2021-09-27T17:00:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>유니티 - 물리 기반 먼지 시뮬레이션</h3>
            <div class="text-muted small">
              <p>
                





                목표


  수십만 ~ 백만 개의 먼지를 렌더링한다.
  먼지들의 움직임을 물리 기반으로 직접 구현하여 시뮬레이션한다.
  진공 청소기로 먼지들을 예쁘게 빨아들인다.






주요 개념


Compute Buffer

  큰 병렬 데이터를 GPU에 전달하거나 쉐이더끼리 공유하기 위해 사용한다.
  Vert/Frag, Compute Shader에서 S...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/behavior-tree/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Jan  5, 2021
  

  <i class="unloaded">2021-01-05T00:26:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>유니티 - 비헤이비어 트리(Behavior Tree)</h3>
            <div class="text-muted small">
              <p>
                





                개념



  FSM (Finite State Machine)의 단점을 보완하기 위해 만들어진 기법
  FSM에서는 상태 전이 조건을 모두 각각의 상태에서 검사하지만, BT에서는 상태 동작 뿐만 아니라 전이 조건도 노드로 관리한다.
  노드 그래프를 통해 시각화하거나 params, 빌더 패턴 등을 활용하여 스크립트 내에서도 가독성 좋게 구성할 수 있다...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.

  v2.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/memo-cs-prime-number/" class="btn btn-outline-primary">
    <p>C# - Prime Number(소수)</p>
  </a>
  

  
  <a href="/posts/memo-cs-static-readonly-vs-const/" class="btn btn-outline-primary">
    <p>Static Readonly vs. Const</p>
  </a>
  

</div>

    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



<script>
/* 코드 블록 우측 상단 Copy 버튼 */
const codes = document.querySelectorAll('.code-button-header + .highlighter-rouge .rouge-code');
const copyCodeButtons = document.querySelectorAll('.copy-code-button');

copyCodeButtons.forEach((copyCodeButton, index) => {
  copyCodeButton.addEventListener('click', () => {
    window.navigator.clipboard.writeText(codes[index].innerText.slice(0, -1));
    copyCodeButton.classList.add('copied');

    setTimeout(() => {
      copyCodeButton.classList.remove('copied');
    }, 2000);
  });
});
</script>


  <!-- image lazy load: https://github.com/ApoorvSaxena/lozad.js -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>

<script type="text/javascript">
  const imgs = document.querySelectorAll('.post-content img');
  const observer = lozad(imgs);
  observer.observe();
</script>




        <!--
  The Footer
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2023
        <a href="https://github.com/rito15">Rito15</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-xl-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/editor/">editor</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/memo/">memo</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/amplify/">amplify</a>
      
        
        <a class="post-tag" href="/tags/thread/">thread</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    
      <!--
  mermaid-js loader
-->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  $(function() {
    let initTheme = "default";

    if ($("html[mode=dark]").length > 0
      || ($("html[mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Markdown converts to HTML */
    $("pre").has("code.language-mermaid").each(function() {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<div class=\"mermaid\">${svgCode}</div>`);
    });

    mermaid.initialize(mermaidConf);
  });
</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://rito15.github.io{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    <div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div>    <div><i class="fa fa-tag fa-fw"></i>{tags}</div>  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>'
});
</script>


    <!-- 2021-06-29 추가 : 애널리틱스 적용 -->
    <!--
  The GA snippet
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-200391565-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-200391565-1');
</script>


  </body>

</html>

