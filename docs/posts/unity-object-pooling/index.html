<!DOCTYPE html>



<html lang="en" 
  
    mode="dark"
  
>

  <!--
  The Head
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme" content="Chirpy v2.7.2">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="유니티 - 오브젝트 풀링(Object Pooling)" />
<meta name="author" content="Rito15" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1. 목표 오브젝트 풀링 기법 이해하기" />
<meta property="og:description" content="1. 목표 오브젝트 풀링 기법 이해하기" />
<link rel="canonical" href="https://rito15.github.io/posts/unity-object-pooling/" />
<meta property="og:url" content="https://rito15.github.io/posts/unity-object-pooling/" />
<meta property="og:site_name" content="Rito15" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-06T01:22:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="유니티 - 오브젝트 풀링(Object Pooling)" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"1. 목표 오브젝트 풀링 기법 이해하기","datePublished":"2021-08-06T01:22:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rito15.github.io/posts/unity-object-pooling/"},"url":"https://rito15.github.io/posts/unity-object-pooling/","author":{"@type":"Person","name":"Rito15"},"headline":"유니티 - 오브젝트 풀링(Object Pooling)","dateModified":"2021-09-17T04:13:36+09:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>유니티 - 오브젝트 풀링(Object Pooling) | Rito15
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2019 Cotes Chung
  Published under the MIT license
-->



<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
    integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
    crossorigin="anonymous">

  <!--
  CSS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->






<link rel="preload" href="/assets/css/post.css" as="style">
<link rel="stylesheet" href="/assets/css/post.css">


  
    <link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css">
    <link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" />
  



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->





<script async src="/assets/js/post.min.js"></script>


  <!-- MathJax -->
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>





</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/favicons/android-icon-192x192.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Rito15</a>
    </div>

    <div class="site-subtitle font-italic">Game Programmer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/tabs/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/rito15" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ghdtkals15','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
      
        
        <span>
          <a href="/">
            Posts
          </a>
        </span>
        
      

      
        <span>유니티 - 오브젝트 풀링(Object Pooling)</span>
      

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>유니티 - 오브젝트 풀링(Object Pooling)</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Fri, Aug  6, 2021,  1:22 AM +0900"
  >

  
  

  
    Aug  6, 2021
  

  <i class="unloaded">2021-08-06T01:22:00+09:00</i>

</span>
          by
          <span class="author">
            Rito15
          </span>
        </div>

        <div>
          <!-- lastmod -->
          
          <span>
            Updated
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago lastmod"
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Fri, Sep 17, 2021,  4:13 AM +0900"
  >

  
  

  
    Sep 17, 2021
  

  <i class="unloaded">2021-09-17T04:13:36+09:00</i>

</span>
          </span>
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->






<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8213 words">45 min</span>


          <!-- page views -->
          

          <!-- HITS -->
          &nbsp;
          <a href="https://hits.seeyoufarm.com"><img min-width="94" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https://rito15.github.io/posts/unity-object-pooling/%2F&count_bg=%23AC58FA&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false"/></a> 

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <h1 id="1-목표">1. 목표</h1>
<hr />
<ul>
  <li>
    <p>오브젝트 풀링 기법 이해하기</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Key</code> 기반 다중 풀링 기법 이해하기</p>
  </li>
  <li>
    <p>오브젝트 풀 매니저 클래스 구현하기</p>
  </li>
</ul>

<p><br /></p>

<h1 id="2-개념">2. 개념</h1>
<hr />

<p>게임오브젝트를 생성, 파괴하는 것은 순간적으로 큰 성능 소모 및 프레임 저하를 발생시킬 수 있다.</p>

<p>따라서 생성, 파괴 대신 활성화, 비활성화 방식을 사용하면 순간적인 프레임 저하를 방지할 수 있다.</p>

<p>이를 오브젝트 풀링 기법이라고 하며, 동일한 여러 개의 오브젝트를 하나의 풀(예 : 리스트, 스택, 큐)에  미리 담아 관리한다.</p>

<p>파괴 대신 비활성화하여 풀에 저장하고, 생성 대신 풀에서 꺼내어 활성화하는 방식을 사용한다.</p>

<p><br /></p>

<p>풀 내의 오브젝트는 파괴되지 않고 메모리에 계속 남아있기 때문에,</p>

<p>CPU 성능 소모를 줄이고 메모리 사용량을 더 늘리는 기법이라고 할 수 있다.</p>

<p><br /></p>

<h1 id="3-참고사항">3. 참고사항</h1>
<hr />

<ul>
  <li>오브젝트 풀링의 대상이 되는 오브젝트 내에 생성되는 순간 발생해야 하는 이벤트가 있을 경우, 활성화 순간에 발생하도록 변경해주어야 한다.<br />
    <ul>
      <li>예시 : <code class="language-plaintext highlighter-rouge">Awake()</code>, <code class="language-plaintext highlighter-rouge">Start()</code> -&gt; <code class="language-plaintext highlighter-rouge">OnEnable()</code>로 이동</li>
    </ul>
  </li>
  <li>
    <p>게임오브젝트 파괴(<code class="language-plaintext highlighter-rouge">Destroy(Object)</code>)를 사용하던 코드는 모두 오브젝트 풀에 의한 비활성화로 변경해야 한다.</p>
  </li>
  <li>
    <p>자주 사용되지 않는 오브젝트가 계속 풀에 남아있으면 불필요하게 메모리를 소모하므로, 때때로 잘 판단하여 제거해줄 필요가 있다.</p>
  </li>
  <li>풀로 사용될 컨테이너 타입으로는 <code class="language-plaintext highlighter-rouge">List&lt;T&gt;</code>, <code class="language-plaintext highlighter-rouge">Stack&lt;T&gt;</code>, <code class="language-plaintext highlighter-rouge">Queue&lt;T&gt;</code> 등을 고려해볼 수 있으며, 각각 성능은 크게 차이 없지만 <code class="language-plaintext highlighter-rouge">Stack&lt;T&gt;</code>이 그나마 가장 낫다고 한다.
    <ul>
      <li><a href="https://forum.unity.com/threads/object-pool-performance.453524/">https://forum.unity.com/threads/object-pool-performance.453524/</a></li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h1 id="4-설계">4. 설계</h1>
<hr />

<h2 id="1-오브젝트-풀링"><strong>[1] 오브젝트 풀링</strong></h2>

<p>오브젝트 풀링의 개념은 간단하다.</p>

<p>게임오브젝트를 파괴하는 대신 비활성화하여 풀에 넣고,</p>

<p>생성하는 대신 풀에서 꺼내어 활성화하면 된다.</p>

<p>따라서 동일한 게임오브젝트 여러 개를 풀링하려면 하나의 풀로 간단히 구현할 수 있다.</p>

<p>풀을 스택으로 구현한다고 할 때, 스택에 단순히 <code class="language-plaintext highlighter-rouge">GameObejct</code>를 담는다면</p>

<p>풀은 <code class="language-plaintext highlighter-rouge">Stack&lt;GameObject&gt;</code> 타입이 된다.</p>

<p><br /></p>

<h2 id="2-다중-풀링"><strong>[2] 다중 풀링</strong></h2>

<p>서로 다른 게임오브젝트들을 각각 풀링하려면 조금 더 복잡해진다.</p>

<p>우선 각각의 풀을 하나의 컨테이너에서 관리해야 한다.</p>

<p>그리고 컨테이너 내의 풀에 접근할 때마다 선형 탐색, 이진 탐색과 같은 방법을 사용하는 것은 비효율적이며, 해시 테이블 형태의 컨테이너를 사용하는 것이 좋다.</p>

<p><code class="language-plaintext highlighter-rouge">C#</code>에서는 <code class="language-plaintext highlighter-rouge">Dictionary&lt;,&gt;</code>를 사용하면 된다.</p>

<p>따라서 각각의 풀마다 접근할 <code class="language-plaintext highlighter-rouge">Key</code>를 미리 정의하고,</p>

<p>다중 풀링 컨테이너는 <code class="language-plaintext highlighter-rouge">Dictionary&lt;KeyType, Stack&lt;GameObject&gt;&gt;</code> 형태로 구현하여</p>

<p><code class="language-plaintext highlighter-rouge">Key</code>를 이용해 풀에 접근하게 될 것이다.</p>

<p><br /></p>

<h2 id="3-샘플-오브젝트"><strong>[3] 샘플 오브젝트</strong></h2>

<p>동일한 게임오브젝트를 복제하여 다수를 풀에 넣어 놓기 위해서는</p>

<p>복제의 대상이 될 샘플 게임오브젝트가 하나씩 필요하다.</p>

<p><code class="language-plaintext highlighter-rouge">Key</code>를 이용해 풀을 관리하는 것처럼,</p>

<p>샘플 오브젝트 역시 <code class="language-plaintext highlighter-rouge">Key</code>를 통해 참조할 수 있도록</p>

<p><code class="language-plaintext highlighter-rouge">Dictionary&lt;KeyType, GameObject&gt;</code>와 같은 형태로 관리한다.</p>

<p>그리고 샘플 오브젝트는 반드시 파괴되지 않도록 보장해줘야 한다.</p>

<p><br /></p>

<h2 id="4-key-선택"><strong>[4] Key 선택</strong></h2>

<p>다중 풀링에서 각각의 풀에 접근하기 위해서는 <code class="language-plaintext highlighter-rouge">Key</code>가 필요하다.</p>

<p>그리고 우선 <code class="language-plaintext highlighter-rouge">Key</code>를 어떻게 정할 것인지, 타입은 무엇으로 할지 결정해야 한다.</p>

<p>사실 가장 간편하면서도 좋은 선택이 될 수 있는 것은 게임오브젝트의 이름 또는 태그를 사용하는 것이다.</p>

<p>항상 동일하게 유지될 샘플 오브젝트의 이름을 <code class="language-plaintext highlighter-rouge">Key</code>로 사용하고,</p>

<p>샘플로부터 복제하여 풀에 넣는 오브젝트들도 동일한 이름을 사용하게 한다.</p>

<p>이렇게 되면 풀에 다시 집어넣을 때,</p>

<p>복제된 오브젝트로부터 번거로운 방식으로 <code class="language-plaintext highlighter-rouge">Key</code>를 알아내는 과정 없이</p>

<p>곧바로 해당 오브젝트의 이름을 <code class="language-plaintext highlighter-rouge">Key</code>로 사용하여 알맞은 풀을 참조하여</p>

<p>곧장 풀에 다시 회수할 수 있다는 이점이 있다.</p>

<p><br /></p>

<p>그런데 현재 유니티에서 이 방식은 치명적인 단점이 있다.</p>

<p>게임오브젝트의 이름과 태그는 각각 <code class="language-plaintext highlighter-rouge">.name</code>, <code class="language-plaintext highlighter-rouge">.tag</code> 프로퍼티로 참조할 수 있는데</p>

<p>이 프로퍼티들을 참조할 때마다 스트링이 동적으로 생성되어 가비지를 남기고,</p>

<p>결국 <code class="language-plaintext highlighter-rouge">GC</code>의 수집 대상이 된다는 점이다.</p>

<p>이렇게 되면 풀링을 통한 활성화/비활성화를 수행할 때마다 <code class="language-plaintext highlighter-rouge">GC</code> 호출이 일어나므로</p>

<p>불필요한 성능 저하가 발생할 수 있다.</p>

<p><br /></p>

<h2 id="5-gc-문제-해결을-위한-2가지-방법"><strong>[5] GC 문제 해결을 위한 2가지 방법</strong></h2>

<p>위의 문제가 발생하는 근본 원인은 다음과 같다.</p>

<p>풀에 저장된 오브젝트를 꺼내어 활성화하는 것(<code class="language-plaintext highlighter-rouge">Spawn</code>)은 아무런 문제가 없지만</p>

<p>오브젝트를 풀에 다시 집어넣을 때(<code class="language-plaintext highlighter-rouge">Despawn</code>),</p>

<p>해당 오브젝트로부터 <code class="language-plaintext highlighter-rouge">Key</code>를 알아내는 과정이 문제가 된다.</p>

<p>이를 해결하기 위해서 두 가지 방안이 있다.</p>

<p><br /></p>

<h3 id="5-1-컴포넌트를-추가로-사용하기"><strong>[5-1] 컴포넌트를 추가로 사용하기</strong></h3>

<p>복제된 오브젝트에 <code class="language-plaintext highlighter-rouge">Key</code>의 정보를 갖고 있는 컴포넌트를 추가한다.</p>

<p>그러면 복제된 오브젝트를 다시 풀에 넣을 때 이 컴포넌트의 <code class="language-plaintext highlighter-rouge">Key</code>를 직접 참조하여</p>

<p>해당되는 풀에 넣어주면 해결된다.</p>

<p>대신, 간단히 <code class="language-plaintext highlighter-rouge">GameObject</code>로 풀링 대상을 참조하던 모든 코드에서</p>

<p>이 컴포넌트의 타입을 참조하도록 해주어야 하며</p>

<p>외부에서 복제된 컴포넌트를 다시 풀에 넣으려고 할 때도</p>

<p>반드시 이 컴포넌트를 참조해야만 한다.</p>

<p><br /></p>

<h3 id="5-2-복제된-오브젝트를-모두-캐싱하기"><strong>[5-2] 복제된 오브젝트를 모두 캐싱하기</strong></h3>

<p><code class="language-plaintext highlighter-rouge">Dictionary&lt;GameObject, Stack&lt;GameObject&gt;&gt;</code> 타입으로</p>

<p>복제된 오브젝트를 키로 사용해 해당하는 풀을 곧바로 참조하는 방법이다.</p>

<p>이를 이용하면 굳이 <code class="language-plaintext highlighter-rouge">[5-1]</code>처럼 별도의 컴포넌트를 사용할 필요가 없고,</p>

<p><code class="language-plaintext highlighter-rouge">GameObject</code> 타입으로 오브젝트를 곧장 참조할 수 있다는 장점이 있다.</p>

<p>대신, 복제된 모든 오브젝트를 <code class="language-plaintext highlighter-rouge">Dictionary</code>에 저장하므로</p>

<p>생성, 파괴 시 반드시 <code class="language-plaintext highlighter-rouge">Dictionary</code>에 추가, 제거하는 과정을 거쳐야 한다.</p>

<p><br /></p>

<h3 id="6-key-타입-결정"><strong>[6] Key 타입 결정</strong></h3>

<p>이제 위의 두 가지 방법 중 하나를 선택하여 문제를 해결할 수 있다.</p>

<p>그리고 <code class="language-plaintext highlighter-rouge">Key</code>의 타입을 원하는 대로 결정할 수 있는데,</p>

<p><code class="language-plaintext highlighter-rouge">string</code> 타입을 우선 생각해볼 수 있다.</p>

<p>문자열을 <code class="language-plaintext highlighter-rouge">Key</code>로 사용하면 직관적이라는 것이 가장 큰 장점이다.</p>

<p>하지만 스크립팅 시 오탈자가 발생하면 치명적일 수 있다는 단점이 있고</p>

<p>혹여나 동적으로 스트링을 생성하면 그대로 <code class="language-plaintext highlighter-rouge">GC</code>의 먹이가 된다는 문제점이 있다.</p>

<p><br /></p>

<p>그 다음으로는 숫자 타입을 고려해볼 수 있다.</p>

<p><code class="language-plaintext highlighter-rouge">int</code>와 같은 숫자 타입을 사용하게 되면,</p>

<p>풀링 대상이 미리 정해져 있는 경우</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">const</span> <span class="kt">int</span> <span class="n">BulletKeyA</span> <span class="p">=</span> <span class="m">101</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">BulletKeyB</span> <span class="p">=</span> <span class="m">102</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>이렇게 미리 상수를 정의하여 참조할 수도 있고</p>

<p>동적으로 풀에 추가된다고 해도, 키가 중복되지 않도록 키 관리 매니저를 만들어서</p>

<p>키를 차례로 발급하여 사용할 수도 있다.</p>

<p><br /></p>

<p>마지막으로 사용자 정의 <code class="language-plaintext highlighter-rouge">enum</code>을 생각해볼 수 있는데,</p>

<p>이는 오로지 모든 풀링 오브젝트가 컴파일 타임에 결정된 경우에 한해 사용한다.</p>

<p>하나의 <code class="language-plaintext highlighter-rouge">enum</code>으로 모든 풀링 오브젝트의 키 정보를 관리할 수 있고</p>

<p>스크립팅 시 문자열과는 다르게 오탈자를 걱정하지 않아도 되므로</p>

<p>컴파일 타임에 미리 풀링 오브젝트를 모두 결정하는 경우라면 굉장히 편리한 방법이라고 할 수 있다.</p>

<p><br /></p>

<h3 id="7-풀의-오브젝트-개수-제한"><strong>[7] 풀의 오브젝트 개수 제한</strong></h3>

<p>풀에서 오브젝트를 꺼내려고 할 때,</p>

<p>풀이 완전히 비어있는 경우를 생각해볼 수 있다.</p>

<p>이런 경우에는 어쩔 수 없이 샘플 오브젝트로부터 새롭게 복제하여 전달해야 한다.</p>

<p><br /></p>

<p>따라서 평소에는 50개 정도의 오브젝트를 만들고 풀에 넣어 사용하다가</p>

<p>순간적으로 500개의 오브젝트를 새로 복제하는 경우가 발생했다고 가정해보자.</p>

<p>이제 500개의 오브젝트를 다시 풀에 전부 집어넣게 되면,</p>

<p>실제로 50개만 필요한데 500개의 오브젝트가 메모리를 점유하게 된다.</p>

<p><br /></p>

<p>따라서 이런 경우를 대비해 미리 각각의 풀마다 개수 한도를 지정해 놓고,</p>

<p>풀 내의 오브젝트가 한도에 도달했을 때 풀에 넣으려고 시도하면</p>

<p>풀에 넣지 않고, 대신 파괴하는 방법을 사용해야 한다.</p>

<p><br /></p>

<p>그런데 위와 같은 경우처럼 500개를 한 번에 파괴하려고 하면</p>

<p>순간적으로 극심한 성능 저하가 발생할 수 있다.</p>

<p>따라서 이를 피하기 위해 일단 한도 이상의 오브젝트를 풀에 회수하는 것을 허용하고,</p>

<p>한도에 도달할 때까지 차근차근 풀 내의 오브젝트들을 파괴하는 방법을 통해 최적화를 고려해볼 수 있다.</p>

<p><br /></p>

<h1 id="5-별도의-컴포넌트-기반으로-구현하기">5. 별도의 컴포넌트 기반으로 구현하기</h1>
<hr />

<p><code class="language-plaintext highlighter-rouge">4 - [5-1]</code>의 방법대로 구현한다.</p>

<h2 id="1-key-타입"><strong>[1] Key 타입</strong></h2>

<p>하나의 타입으로 지정할 수도 있고,</p>

<p>제네릭으로 클래스를 정의한 다음 타입을 특정하여 상속받아 사용할 수도 있지만</p>

<p>다음과 같이 <code class="language-plaintext highlighter-rouge">using</code>을 활용하여 스크립트 상단에서 정하도록 한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">KeyType</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h2 id="2-poolobjectdata-클래스"><strong>[2] PoolObjectData 클래스</strong></h2>

<p>각각의 풀에 대한 정보를 하나의 클래스로 묶어 정의한다.</p>

<p>추후 작성할 풀 매니저의 인스펙터에서 리스트에 담아 사용하며,</p>

<p>풀 매니저는 이를 기반으로 풀링 데이터를 생성한다.</p>

<p>인스펙터에서 표시해야 하므로 <code class="language-plaintext highlighter-rouge">[System.Serializable]</code> 애트리뷰트를 붙여준다.</p>

<p><br /></p>

<details>
  <summary> 
PoolObjectData.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KeyType</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt; 풀 대상 오브젝트에 대한 정보 &lt;/summary&gt;</span>
<span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PoolObjectData</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">INITIAL_COUNT</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_COUNT</span> <span class="p">=</span> <span class="m">50</span><span class="p">;</span>

    <span class="k">public</span> <span class="n">KeyType</span> <span class="n">key</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">prefab</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">initialObjectCount</span> <span class="p">=</span> <span class="n">INITIAL_COUNT</span><span class="p">;</span> <span class="c1">// 오브젝트 초기 생성 개수</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">maxObjectCount</span>     <span class="p">=</span> <span class="n">MAX_COUNT</span><span class="p">;</span>     <span class="c1">// 큐 내에 보관할 수 있는 오브젝트 최대 개수</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="3-poolobject-클래스"><strong>[3] PoolObject 클래스</strong></h2>

<p>복제된 오브젝트의 컴포넌트로 들어가는 클래스.</p>

<p>필드로 키값을 보관한다.</p>

<p><br /></p>

<details>
  <summary> 
PoolObject.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">KeyType</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>

<span class="p">[</span><span class="n">DisallowMultipleComponent</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PoolObject</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">KeyType</span> <span class="n">key</span><span class="p">;</span>

    <span class="c1">/// &lt;summary&gt; 게임오브젝트 복제 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">PoolObject</span> <span class="nf">Clone</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GameObject</span> <span class="n">go</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">gameObject</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">go</span><span class="p">.</span><span class="nf">TryGetComponent</span><span class="p">(</span><span class="k">out</span> <span class="n">PoolObject</span> <span class="n">po</span><span class="p">))</span>
            <span class="n">po</span> <span class="p">=</span> <span class="n">go</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">PoolObject</span><span class="p">&gt;();</span>
        <span class="n">go</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">po</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 게임오브젝트 활성화 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Activate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">gameObject</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 게임오브젝트 비활성화 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Deactivate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">gameObject</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="4-objectpoolmanager-클래스"><strong>[4] ObjectPoolManager 클래스</strong></h2>

<p>각각의 풀을 생성하고, 풀에서 오브젝트를 꺼내고 집어넣는 역할을 수행한다.</p>

<p>싱글톤으로 구현하는 것이 좋다.</p>

<p>싱글톤 구현부는 생략한다.</p>

<p><br /></p>

<p><code class="language-plaintext highlighter-rouge">ObjectPoolManager</code>의 주요 기능은 세가지이다.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Register</code> : 키를 등록하고, 해당 키에 대해 풀을 생성한다.</li>
  <li><code class="language-plaintext highlighter-rouge">Spawn</code> : 키를 참조하여, 해당되는 풀에서 오브젝트를 꺼내온다.</li>
  <li><code class="language-plaintext highlighter-rouge">Despawn</code> : 오브젝트를 다시 풀에 집어넣는다.</li>
</ol>

<p><br /></p>

<details>
  <summary> 
ObjectPoolManager.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">KeyType</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt; </span>
<span class="c1">/// 오브젝트 풀 관리 싱글톤</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="p">[</span><span class="n">DisallowMultipleComponent</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ObjectPoolManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="c1">// 인스펙터에서 오브젝트 풀링 대상 정보 추가</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PoolObjectData</span><span class="p">&gt;</span> <span class="n">_poolObjectDataList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PoolObjectData</span><span class="p">&gt;(</span><span class="m">4</span><span class="p">);</span>
    
    <span class="c1">// 복제될 오브젝트의 원본 딕셔너리</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">PoolObject</span><span class="p">&gt;</span> <span class="n">_sampleDict</span><span class="p">;</span>
    
    <span class="c1">// 풀링 정보 딕셔너리</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">PoolObjectData</span><span class="p">&gt;</span> <span class="n">_dataDict</span><span class="p">;</span>
    
    <span class="c1">// 풀 딕셔너리</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">PoolObject</span><span class="p">&gt;&gt;</span> <span class="n">_poolDict</span><span class="p">;</span>
    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Init</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="p">=</span> <span class="n">_poolObjectDataList</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="c1">// 1. Dictionary 생성</span>
        <span class="n">_sampleDict</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">PoolObject</span><span class="p">&gt;(</span><span class="n">len</span><span class="p">);</span>
        <span class="n">_dataDict</span>   <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">PoolObjectData</span><span class="p">&gt;(</span><span class="n">len</span><span class="p">);</span>
        <span class="n">_poolDict</span>   <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">PoolObject</span><span class="p">&gt;&gt;(</span><span class="n">len</span><span class="p">);</span>

        <span class="c1">// 2. Data로부터 새로운 Pool 오브젝트 정보 생성</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">data</span> <span class="k">in</span> <span class="n">_poolObjectDataList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">Register</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">/// &lt;summary&gt; Pool 데이터로부터 새로운 Pool 오브젝트 정보 등록 &lt;/summary&gt;</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">PoolObjectData</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 중복 키는 등록 불가능</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_poolDict</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 1. 샘플 게임오브젝트 생성, PoolObject 컴포넌트 존재 확인</span>
        <span class="n">GameObject</span> <span class="n">sample</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">prefab</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">sample</span><span class="p">.</span><span class="nf">TryGetComponent</span><span class="p">(</span><span class="k">out</span> <span class="n">PoolObject</span> <span class="n">po</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">po</span> <span class="p">=</span> <span class="n">sample</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">PoolObject</span><span class="p">&gt;();</span>
            <span class="n">po</span><span class="p">.</span><span class="n">key</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">sample</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

        <span class="c1">// 2. Pool Dictionary에 풀 생성 + 풀에 미리 오브젝트들 만들어 담아놓기</span>
        <span class="n">Stack</span><span class="p">&lt;</span><span class="n">PoolObject</span><span class="p">&gt;</span> <span class="n">pool</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">PoolObject</span><span class="p">&gt;(</span><span class="n">data</span><span class="p">.</span><span class="n">maxObjectCount</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">initialObjectCount</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">PoolObject</span> <span class="n">clone</span> <span class="p">=</span> <span class="n">po</span><span class="p">.</span><span class="nf">Clone</span><span class="p">();</span>
            <span class="n">pool</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">clone</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// 3. 딕셔너리에 추가</span>
        <span class="n">_sampleDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">po</span><span class="p">);</span>
        <span class="n">_dataDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
        <span class="n">_poolDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">pool</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">/// &lt;summary&gt; 풀에서 꺼내오기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">PoolObject</span> <span class="nf">Spawn</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 키가 존재하지 않는 경우 null 리턴</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">_poolDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">pool</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">PoolObject</span> <span class="n">po</span><span class="p">;</span>

        <span class="c1">// 1. 풀에 재고가 있는 경우 : 꺼내오기</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">po</span> <span class="p">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">Pop</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">// 2. 재고가 없는 경우 샘플로부터 복제</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">po</span> <span class="p">=</span> <span class="n">_sampleDict</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nf">Clone</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">po</span><span class="p">.</span><span class="nf">Activate</span><span class="p">();</span>

        <span class="k">return</span> <span class="n">po</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 풀에 집어넣기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Despawn</span><span class="p">(</span><span class="n">PoolObject</span> <span class="n">po</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 키가 존재하지 않는 경우 종료</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">_poolDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">po</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">pool</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">KeyType</span> <span class="n">key</span> <span class="p">=</span> <span class="n">po</span><span class="p">.</span><span class="n">key</span><span class="p">;</span>

        <span class="c1">// 1. 풀에 넣을 수 있는 경우 : 풀에 넣기</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">Count</span> <span class="p">&lt;</span> <span class="n">_dataDict</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">maxObjectCount</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">pool</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">po</span><span class="p">);</span>
            <span class="n">po</span><span class="p">.</span><span class="nf">Deactivate</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">// 2. 풀의 한도가 가득 찬 경우 : 파괴하기</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="nf">Destroy</span><span class="p">(</span><span class="n">po</span><span class="p">.</span><span class="n">gameObject</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="6-gameobject-기반으로-구현하기">6. GameObject 기반으로 구현하기</h1>
<hr />

<p><code class="language-plaintext highlighter-rouge">4 - [5-2]</code>의 방법대로 구현한다.</p>

<p><code class="language-plaintext highlighter-rouge">Key</code> 타입과 <code class="language-plaintext highlighter-rouge">PoolObjectData</code> 클래스는 <code class="language-plaintext highlighter-rouge">5</code>번의 구현과 같다.</p>

<p><br /></p>

<h2 id="objectpoolmanager-클래스"><strong>ObjectPoolManager 클래스</strong></h2>

<details>
  <summary> 
ObjectPoolManager.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">KeyType</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt; </span>
<span class="c1">/// 오브젝트 풀 관리 싱글톤</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="p">[</span><span class="n">DisallowMultipleComponent</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ObjectPoolManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PoolObjectData</span><span class="p">&gt;</span> <span class="n">_poolObjectDataList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PoolObjectData</span><span class="p">&gt;(</span><span class="m">4</span><span class="p">);</span>
    
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">_sampleDict</span><span class="p">;</span>   <span class="c1">// Key - 복제용 오브젝트 원본</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">PoolObjectData</span><span class="p">&gt;</span> <span class="n">_dataDict</span><span class="p">;</span> <span class="c1">// Key - 풀 정보</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;&gt;</span> <span class="n">_poolDict</span><span class="p">;</span>         <span class="c1">// Key - 풀</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;&gt;</span> <span class="n">_clonePoolDict</span><span class="p">;</span> <span class="c1">// 복제된 게임오브젝트 - 풀</span>
    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Init</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="p">=</span> <span class="n">_poolObjectDataList</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="c1">// 1. Dictionary 생성</span>
        <span class="n">_sampleDict</span>    <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">&gt;(</span><span class="n">len</span><span class="p">);</span>
        <span class="n">_dataDict</span>      <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">PoolObjectData</span><span class="p">&gt;(</span><span class="n">len</span><span class="p">);</span>
        <span class="n">_poolDict</span>      <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;&gt;(</span><span class="n">len</span><span class="p">);</span>
        <span class="n">_clonePoolDict</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;&gt;(</span><span class="n">len</span> <span class="p">*</span> <span class="n">PoolObjectData</span><span class="p">.</span><span class="n">INITIAL_COUNT</span><span class="p">);</span>

        <span class="c1">// 2. Data로부터 새로운 Pool 오브젝트 정보 생성</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">data</span> <span class="k">in</span> <span class="n">_poolObjectDataList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">RegisterInternal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">/// &lt;summary&gt; Pool 데이터로부터 새로운 Pool 오브젝트 정보 등록 &lt;/summary&gt;</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">RegisterInternal</span><span class="p">(</span><span class="n">PoolObjectData</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 중복 키는 등록 불가능</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_poolDict</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 1. 샘플 게임오브젝트 생성, PoolObject 컴포넌트 존재 확인</span>
        <span class="n">GameObject</span> <span class="n">sample</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">prefab</span><span class="p">);</span>
        <span class="n">sample</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">prefab</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
        <span class="n">sample</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

        <span class="c1">// 2. Pool Dictionary에 풀 생성 + 풀에 미리 오브젝트들 만들어 담아놓기</span>
        <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">pool</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="n">data</span><span class="p">.</span><span class="n">maxObjectCount</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">initialObjectCount</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">GameObject</span> <span class="n">clone</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">prefab</span><span class="p">);</span>
            <span class="n">clone</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
            <span class="n">pool</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">clone</span><span class="p">);</span>

            <span class="n">_clonePoolDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">clone</span><span class="p">,</span> <span class="n">pool</span><span class="p">);</span> <span class="c1">// Clone-Stack 캐싱</span>
        <span class="p">}</span>

        <span class="c1">// 3. 딕셔너리에 추가</span>
        <span class="n">_sampleDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">sample</span><span class="p">);</span>
        <span class="n">_dataDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
        <span class="n">_poolDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">pool</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">/// &lt;summary&gt; 샘플 오브젝트 복제하기 &lt;/summary&gt;</span>
    <span class="k">private</span> <span class="n">GameObject</span> <span class="nf">CloneFromSample</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">_sampleDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="n">GameObject</span> <span class="n">sample</span><span class="p">))</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

        <span class="k">return</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">/// &lt;summary&gt; 풀에서 꺼내오기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="nf">Spawn</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 키가 존재하지 않는 경우 null 리턴</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">_poolDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">pool</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">GameObject</span> <span class="n">go</span><span class="p">;</span>

        <span class="c1">// 1. 풀에 재고가 있는 경우 : 꺼내오기</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">go</span> <span class="p">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">Pop</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">// 2. 재고가 없는 경우 샘플로부터 복제</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">go</span> <span class="p">=</span> <span class="nf">CloneFromSample</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
            <span class="n">_clonePoolDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="n">pool</span><span class="p">);</span> <span class="c1">// Clone-Stack 캐싱</span>
        <span class="p">}</span>

        <span class="n">go</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="n">go</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">go</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 풀에 집어넣기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Despawn</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">go</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 캐싱된 게임오브젝트가 아닌 경우 파괴</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">_clonePoolDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">pool</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nf">Destroy</span><span class="p">(</span><span class="n">go</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 집어넣기</span>
        <span class="n">go</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
        <span class="n">pool</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">go</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="7-에디터-전용-테스트-기능-구현">7. 에디터 전용 테스트 기능 구현</h1>
<hr />

<ul>
  <li><code class="language-plaintext highlighter-rouge">6</code>에 이어 구현한다.</li>
</ul>

<p><br /></p>

<p>위에서 구현한 코드를 그대로 사용할 경우,</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/128390737-847b3713-b68c-4075-a485-10c6925f800b.png" alt="image" /></p>

<p>이렇게 하이라키에 오브젝트가 가득 차서 작업이 불편해진다.</p>

<p>따라서 에디터에서는 각각의 풀별로 공통 게임오브젝트로 묶어주고,</p>

<p>풀마다 갖고 있는 오브젝트 개수도 손쉽게 확인할 수 있도록 해준다.</p>

<p><br /></p>

<p>우선 스크립트의 최상단에 다음과 같이 추가해준다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="cp">#if UNITY_EDITOR
#define TEST_ON
#endif
</span></pre></td></tr></tbody></table></code></div></div>

<p>그리고 다음 메소드를 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"TEST_ON"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">TestModeOnly</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">action</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">TestModeOnly()</code> 메소드의 호출은 전처리기에서 <code class="language-plaintext highlighter-rouge">TEST_ON</code>을 선언한 경우에만 동작한다.</p>

<p>그런데 <code class="language-plaintext highlighter-rouge">TEST_ON</code>은 <code class="language-plaintext highlighter-rouge">UNITY_EDITOR</code> 선언이 유효한 경우에만 선언되므로</p>

<p>빌드 시 무조건 동작하지 않게 된다.</p>

<p><br /></p>

<p>이제 스크립트에 다음 코드들을 작성해준다.</p>

<details>
  <summary> 
.
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">_t_ContainerDict</span><span class="p">;</span>
<span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;,</span> <span class="n">KeyType</span><span class="p">&gt;</span> <span class="n">_t_poolKeyDict</span><span class="p">;</span>

<span class="c1">// 컨테이너 이름 변경</span>
<span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"TEST_ON"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">Test_ChangeContainerName</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_testModeOn</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">pool</span> <span class="p">=</span> <span class="n">_poolDict</span><span class="p">[</span><span class="n">key</span><span class="p">];</span>

    <span class="kt">int</span> <span class="n">cloneCount</span> <span class="p">=</span> <span class="n">_cloneDict</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">v</span> <span class="p">=&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">pool</span> <span class="p">==</span> <span class="n">pool</span><span class="p">).</span><span class="nf">Count</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">inPoolCount</span> <span class="p">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">maxCount</span> <span class="p">=</span> <span class="n">_dataDict</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">maxObjectCount</span><span class="p">;</span>

    <span class="n">_t_ContainerDict</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">name</span>
        <span class="p">=</span> <span class="s">$"Pool &lt;</span><span class="p">{</span><span class="n">key</span><span class="p">}</span><span class="s">&gt; - [</span><span class="p">{</span><span class="n">cloneCount</span> <span class="p">-</span> <span class="n">inPoolCount</span><span class="p">}</span><span class="s">] Used, [</span><span class="p">{</span><span class="n">inPoolCount</span><span class="p">}</span><span class="s">] Available, [</span><span class="p">{</span><span class="n">maxCount</span><span class="p">}</span><span class="s">] Max"</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">TestModeOnly</span><span class="p">(()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">_t_ContainerDict</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">&gt;();</span>
        <span class="n">_t_poolKeyDict</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;,</span> <span class="n">KeyType</span><span class="p">&gt;();</span>
    <span class="p">});</span>

    <span class="c1">// Codes...</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">RegisterInternal</span><span class="p">(</span><span class="n">PoolObjectData</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Codes...</span>
    
    <span class="nf">TestModeOnly</span><span class="p">(()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="c1">// 샘플을 공통 게임오브젝트의 자식으로 묶기</span>
        <span class="kt">string</span> <span class="n">posName</span> <span class="p">=</span> <span class="s">"ObjectPool Samples"</span><span class="p">;</span>
        <span class="n">GameObject</span> <span class="n">parentOfSamples</span> <span class="p">=</span> <span class="n">GameObject</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="n">posName</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">parentOfSamples</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="n">parentOfSamples</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GameObject</span><span class="p">(</span><span class="n">posName</span><span class="p">);</span>

        <span class="n">sample</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">parentOfSamples</span><span class="p">.</span><span class="n">transform</span><span class="p">);</span>

        <span class="c1">// 풀 - 키 딕셔너리에 추가</span>
        <span class="n">_t_poolKeyDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">);</span>

        <span class="c1">// 컨테이너 게임오브젝트 생성</span>
        <span class="n">_t_ContainerDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="k">new</span> <span class="nf">GameObject</span><span class="p">(</span><span class="s">""</span><span class="p">));</span>

        <span class="c1">// 컨테이너 자식으로 설정</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">pool</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">item</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">_t_ContainerDict</span><span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">].</span><span class="n">transform</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="c1">// 컨테이너 이름 변경</span>
        <span class="nf">Test_ChangeContainerName</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="k">public</span> <span class="n">GameObject</span> <span class="nf">Spawn</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Codes...</span>

    <span class="nf">TestModeOnly</span><span class="p">(()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="c1">// 컨테이너 이름 변경</span>
        <span class="nf">Test_ChangeContainerName</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="n">go</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 풀에 집어넣기 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Despawn</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">go</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Codes...</span>
    
    <span class="nf">TestModeOnly</span><span class="p">(()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">KeyType</span> <span class="n">key</span> <span class="p">=</span> <span class="n">_t_poolKeyDict</span><span class="p">[</span><span class="n">pool</span><span class="p">];</span>

        <span class="c1">// 컨테이너 자식으로 넣기</span>
        <span class="n">go</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">_t_ContainerDict</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">transform</span><span class="p">);</span>

        <span class="c1">// 컨테이너 이름 변경</span>
        <span class="nf">Test_ChangeContainerName</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p>이제 하이라키에서 다음과 같이 깔끔히 정리되는 것을 확인할 수 있다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/128391120-dcd7add3-e930-4448-a574-15a58c562f4d.png" alt="image" /></p>

<p><br /></p>

<h1 id="8-조건적-디버깅-구현">8. 조건적 디버깅 구현</h1>
<hr />

<p><code class="language-plaintext highlighter-rouge">bool</code>타입 필드의 체크/해제로 활성화/비활성화되는 디버그 콘솔 출력 기능을 구현한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="cp">#if UNITY_EDITOR
#define DEBUG_ON
#define TEST_ON
#endif
</span></pre></td></tr></tbody></table></code></div></div>

<p>위와 같이 전처리기를 통해 <code class="language-plaintext highlighter-rouge">DEBUG_ON</code> 선언을 추가해준다.</p>

<p>만약 빌드 이후 디버그 콘솔 확인이 필요할 경우,</p>

<p><code class="language-plaintext highlighter-rouge">#if UNITY_EDITOR</code> ~ <code class="language-plaintext highlighter-rouge">#endif</code> 바깥으로 옮겨준다.</p>

<p><code class="language-plaintext highlighter-rouge">bool</code> 타입 필드만 사용해도 활성화/비활성화가 가능한데 굳이 전처리 선언을 해주는 이유는</p>

<p>최종 빌드 시 컴파일 대상에서 완전히 제외시키기 위함이다.</p>

<p><br /></p>

<p>그리고 다음과 같이 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
<span class="k">private</span> <span class="kt">bool</span> <span class="n">_debugOn</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

<span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"DEBUG_ON"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">DebugLog</span><span class="p">(</span><span class="kt">string</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_debugOn</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"DEBUG_ON"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">DebugLog</span><span class="p">(</span><span class="kt">bool</span> <span class="n">condition</span><span class="p">,</span> <span class="kt">string</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_debugOn</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>기능마다 디버그 출력 여부를 분리해줄 수도 있다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="nf">Header</span><span class="p">(</span><span class="s">"Debug Options"</span><span class="p">)]</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="kt">bool</span> <span class="n">_debugOn</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="kt">bool</span> <span class="n">_debugRegister</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="kt">bool</span> <span class="n">_debugSpawn</span>    <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="kt">bool</span> <span class="n">_debugDespawn</span>  <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h1 id="9-추가-기능-구현">9. 추가 기능 구현</h1>
<hr />

<h2 id="1-register-api-제공"><strong>[1] Register API 제공</strong></h2>

<p>플레이 도중에도 원하는 타이밍에 동적으로 새로운 오브젝트를 풀에 등록할 수 있도록 메소드를 제공한다.</p>

<p><br /></p>

<details>
  <summary> 
.
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt; 키를 등록하고 새로운 풀 생성 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">,</span> <span class="n">GameObject</span> <span class="n">prefab</span><span class="p">,</span> 
    <span class="kt">int</span> <span class="n">initalCount</span> <span class="p">=</span> <span class="n">PoolObjectData</span><span class="p">.</span><span class="n">INITIAL_COUNT</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxCount</span> <span class="p">=</span> <span class="n">PoolObjectData</span><span class="p">.</span><span class="n">MAX_COUNT</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 중복 키는 등록 불가능</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_poolDict</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugRegister</span><span class="p">,</span> <span class="s">$"</span><span class="p">{</span><span class="n">key</span><span class="p">}</span><span class="s">가 이미 Pool Queue Dict에 존재합니다."</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">initalCount</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="n">initalCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">maxCount</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span> <span class="n">maxCount</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

    <span class="n">PoolObjectData</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PoolObjectData</span>
    <span class="p">{</span>
        <span class="n">key</span> <span class="p">=</span> <span class="n">key</span><span class="p">,</span>
        <span class="n">prefab</span> <span class="p">=</span> <span class="n">prefab</span><span class="p">,</span>
        <span class="n">initialObjectCount</span> <span class="p">=</span> <span class="n">initalCount</span><span class="p">,</span>
        <span class="n">maxObjectCount</span> <span class="p">=</span> <span class="n">maxCount</span>
    <span class="p">};</span>
    <span class="n">_poolObjectDataList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

    <span class="nf">RegisterInternal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="2-풀-한도-이상의-오브젝트-점진적-파괴"><strong>[2] 풀 한도 이상의 오브젝트 점진적 파괴</strong></h2>

<p>각각의 풀마다 정해진 한도(기본값 : 50)를 초과하여 오브젝트가 저장될 경우</p>

<p>초과분 오브젝트를 하나씩 천천히 파괴한다.</p>

<p>코루틴을 이용해 구현하며, 풀 하나당 코루틴을 하나씩 배정한다.</p>

<p><br /></p>

<details>
  <summary> 
.
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
<span class="k">private</span> <span class="kt">float</span> <span class="n">_poolCleaningInterval</span> <span class="p">=</span> <span class="m">0.1f</span><span class="p">;</span> <span class="c1">// 풀 한도 초과 오브젝트 제거 간격</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">RegisterInternal</span><span class="p">(</span><span class="n">PoolObjectData</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">DebugLog</span><span class="p">(</span><span class="s">$"Register : </span><span class="p">{</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

    <span class="c1">// Codes...</span>
    
    <span class="c1">// 클리너 코루틴 시작</span>
    <span class="nf">StartCoroutine</span><span class="p">(</span><span class="nf">PoolCleanerRoutine</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">key</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 각 풀마다 한도 개수를 초과할 경우, 점진적으로 내부 오브젝트 파괴 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="n">IEnumerator</span> <span class="nf">PoolCleanerRoutine</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_poolDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">pool</span><span class="p">))</span> <span class="k">yield</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_dataDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">data</span><span class="p">))</span> <span class="k">yield</span> <span class="k">break</span><span class="p">;</span>
    <span class="n">WaitForSeconds</span> <span class="n">wfs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="n">_poolCleaningInterval</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="n">data</span><span class="p">.</span><span class="n">maxObjectCount</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">GameObject</span> <span class="n">clone</span> <span class="p">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">Pop</span><span class="p">();</span> <span class="c1">// 풀에서 꺼내기</span>
            <span class="n">_cloneDict</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">clone</span><span class="p">);</span>      <span class="c1">// Clone - Pool 딕셔너리에서 제거</span>
            <span class="nf">Destroy</span><span class="p">(</span><span class="n">clone</span><span class="p">);</span>                <span class="c1">// 게임오브젝트 파괴</span>

            <span class="nf">Test_ChangeContainerName</span><span class="p">(</span><span class="n">key</span><span class="p">);</span> <span class="c1">// 컨테이너 이름 변경</span>
        <span class="p">}</span>

        <span class="k">yield</span> <span class="k">return</span> <span class="n">wfs</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="3-관계-없는-게임오브젝트에-대한-despawn-처리"><strong>[3] 관계 없는 게임오브젝트에 대한 Despawn 처리</strong></h2>

<p>풀에서 제공되지 않은 오브젝트에 대해 의도치 않게 <code class="language-plaintext highlighter-rouge">Despawn</code>을 시도하는 경우가 발생할 수도 있다.</p>

<p>엄격하게 대응하려면 여기에 예외를 발생시키고,</p>

<p>관대하게 대응하려면 <code class="language-plaintext highlighter-rouge">Destroy</code>를 호출해주거나 무시할 수 있다.</p>

<p>인스펙터에서 세 가지 옵션 중 선택하여, 그에 따라 처리하도록 해준다.</p>

<p><br /></p>

<details>
  <summary> 
.
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt; 풀에서 제공되지 않은 오브젝트에 대한 Despawn 처리 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">enum</span> <span class="n">NonePoolObjectDespawnPolicy</span>
<span class="p">{</span>
    <span class="n">Ignore</span><span class="p">,</span>
    <span class="n">ThrowException</span><span class="p">,</span>
    <span class="n">Destroy</span>
<span class="p">}</span>

<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
<span class="k">private</span> <span class="n">NonePoolObjectDespawnPolicy</span> <span class="n">_nonePoolObjectDespawnPolicy</span> <span class="p">=</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">Destroy</span><span class="p">;</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">Despawn</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">go</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">go</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">go</span><span class="p">.</span><span class="n">activeSelf</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="c1">// 복제된 게임오브젝트가 아닌 경우 - 정책에 따라 처리</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_cloneDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">cloneData</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">_nonePoolObjectDespawnPolicy</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">Ignore</span><span class="p">:</span>
                <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"풀에서 제공된 오브젝트가 아닙니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">ThrowException</span><span class="p">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"풀에서 제공된 오브젝트가 아닙니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">Destroy</span><span class="p">:</span>
                <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"풀에서 제공하지 않은 오브젝트를 파괴합니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
                <span class="nf">Destroy</span><span class="p">(</span><span class="n">go</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"Despawn : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
    
    <span class="c1">// 집어넣기</span>
    <span class="n">go</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="n">pool</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">go</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="4-지정된-시간-후-despawn-기능"><strong>[4] 지정된 시간 후 Despawn 기능</strong></h2>

<p><code class="language-plaintext highlighter-rouge">Destroy(obj, time)</code> 메소드를 통해 오브젝트를 일정 시간 후 파괴하는 기능처럼</p>

<p>지정된 시간이 지나면 풀에 회수되는 기능을 구현한다.</p>

<p>가장 간단한 방법은 각각의 오브젝트마다 코루틴을 사용하는 것이다.</p>

<p>하지만 코루틴의 실행 자체가 가비지를 발생시키고,</p>

<p>오브젝트마다 코루틴을 실행시키는 것은 성능에 좋지 않을 수 있기 때문에 다른 방법을 사용한다.</p>

<p><br /></p>

<h3 id="task-사용"><strong>Task 사용</strong></h3>

<p>여기서 사용할 방법은 <code class="language-plaintext highlighter-rouge">Task</code>를 활용하는 것이다.</p>

<p><code class="language-plaintext highlighter-rouge">Despawn</code>이 예약될 경우 <code class="language-plaintext highlighter-rouge">Task</code>를 실행시켜 딜레이를 기다린 후 풀에 회수한다.</p>

<p>그런데 풀에 회수하기 위헤 게임오브젝트를 비활성화하는 작업은 <code class="language-plaintext highlighter-rouge">Unity API</code>에 속하므로</p>

<p>워커 스레드에서 동작하는 <code class="language-plaintext highlighter-rouge">Task</code>를 통해 실행할 수 없다.</p>

<p>따라서 <code class="language-plaintext highlighter-rouge">Main Thread Dispatcher</code>의 방식처럼</p>

<p>스레드간 동기화되는 <code class="language-plaintext highlighter-rouge">Queue</code>를 하나 만들고,</p>

<p><code class="language-plaintext highlighter-rouge">Task</code>에서는 예약된 대상 오브젝트를 <code class="language-plaintext highlighter-rouge">Queue</code>에 넣게 된다.</p>

<p>그리고 <code class="language-plaintext highlighter-rouge">Update()</code>에서 이 <code class="language-plaintext highlighter-rouge">Queue</code>를 확인하여,</p>

<p>담겨있는 요소들을 모두 꺼내어 풀에 회수해준다.</p>

<p><br /></p>

<h3 id="version-관리-기법"><strong>Version 관리 기법</strong></h3>

<p>추가적으로 고려해야 할 사항이 있다.</p>

<ol>
  <li>이미 예약된 오브젝트에 예약을 중첩 또는 갱신하는 경우</li>
  <li>이미 예약된 오브젝트를 즉시 <code class="language-plaintext highlighter-rouge">Despawn</code>하려는 경우</li>
</ol>

<p>유연한 처리를 위해서는 위의 두 경우에 모두 기존 예약을 취소해주는 것이 좋다.</p>

<p>그런데 <code class="language-plaintext highlighter-rouge">Task</code>를 사용하는 경우, 진행 중인 <code class="language-plaintext highlighter-rouge">Delay</code>를 취소할 수는 없다.</p>

<p>굳이 이를 취소하려면 일정 주기로 바쁜 대기를 해야 하는데,</p>

<p>성능 저하를 유발할 뿐더러 예약 확인을 위한 스레드 동기화 처리도 필요하다.</p>

<p>대신 <code class="language-plaintext highlighter-rouge">Version</code>을 적용하면 이에 유연하게 대처할 수 있다.</p>

<p><br /></p>

<p>방법은 다음과 같다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Despawn</code> 예약 정보를 클래스로 정의한다.</li>
  <li><code class="language-plaintext highlighter-rouge">Despawn</code> 예약 정보에 정수 타입의 <code class="language-plaintext highlighter-rouge">Version</code>을 필드로 추가한다.</li>
  <li><code class="language-plaintext highlighter-rouge">Despawn</code>의 예약을 갱신하거나 취소할 때마다 <code class="language-plaintext highlighter-rouge">Version</code>을 <code class="language-plaintext highlighter-rouge">1</code> 증가시킨다.</li>
  <li><code class="language-plaintext highlighter-rouge">Task.Delay</code>전후의 <code class="language-plaintext highlighter-rouge">Version</code>을 비교하여, 일치하는 경우에만 <code class="language-plaintext highlighter-rouge">Despawn</code>을 수행한다.</li>
</ul>

<p><br /></p>

<h3 id="구현"><strong>구현</strong></h3>

<details>
  <summary> 
.
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt; 복제된 오브젝트의 예약 정보 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">class</span> <span class="nc">CloneScheduleInfo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">GameObject</span> <span class="n">clone</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">pool</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">DespawnScheduled</span> <span class="p">=&gt;</span> <span class="n">_despawnScheduled</span><span class="p">;</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="n">_despawnScheduled</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_scheduleVersion</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">CloneScheduleInfo</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">clone</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">pool</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">clone</span> <span class="p">=</span> <span class="n">clone</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">pool</span> <span class="p">=</span> <span class="n">pool</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_despawnScheduled</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_scheduleVersion</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; Despawn 예약하고 버전 반환 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="nf">ScheduleToDespawn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_despawnScheduled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">_scheduleVersion</span><span class="p">++;</span>

        <span class="k">return</span> <span class="n">_scheduleVersion</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 예약 취소 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">CancelSchedule</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_despawnScheduled</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="n">_despawnScheduled</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">_scheduleVersion</span><span class="p">++;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 예약 유효성 검증 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsScheduleValid</span><span class="p">(</span><span class="kt">int</span> <span class="n">prevVersion</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_despawnScheduled</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">prevVersion</span> <span class="p">==</span> <span class="n">_scheduleVersion</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 복제된 게임오브젝트 - 클론 정보</span>
<span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">,</span> <span class="n">CloneScheduleInfo</span><span class="p">&gt;</span> <span class="n">_cloneDict</span><span class="p">;</span>

<span class="c1">// 디스폰 스케줄링 동기화 큐</span>
<span class="k">private</span> <span class="k">readonly</span> <span class="n">ConcurrentQueue</span><span class="p">&lt;</span><span class="n">CloneScheduleInfo</span><span class="p">&gt;</span> <span class="n">_despawnScheduleQueue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConcurrentQueue</span><span class="p">&lt;</span><span class="n">CloneScheduleInfo</span><span class="p">&gt;();</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Codes..</span>

    <span class="n">_sampleDict</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">&gt;(</span><span class="n">len</span><span class="p">);</span>
    <span class="n">_dataDict</span>   <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">PoolObjectData</span><span class="p">&gt;(</span><span class="n">len</span><span class="p">);</span>
    <span class="n">_poolDict</span>   <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">KeyType</span><span class="p">,</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;&gt;(</span><span class="n">len</span><span class="p">);</span>
    
    <span class="c1">// 추가</span>
    <span class="n">_cloneDict</span>  <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">,</span> <span class="n">CloneScheduleInfo</span><span class="p">&gt;(</span><span class="n">len</span> <span class="p">*</span> <span class="n">PoolObjectData</span><span class="p">.</span><span class="n">INITIAL_COUNT</span><span class="p">);</span>

    <span class="c1">// Codes..</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">RegisterInternal</span><span class="p">(</span><span class="n">PoolObjectData</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Codes...</span>

    <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">pool</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Stack</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="n">data</span><span class="p">.</span><span class="n">maxObjectCount</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">initialObjectCount</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="n">GameObject</span> <span class="n">clone</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">prefab</span><span class="p">);</span>
        <span class="n">clone</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
        <span class="n">pool</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">clone</span><span class="p">);</span>

        <span class="c1">// 추가</span>
        <span class="n">_cloneDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">clone</span><span class="p">,</span> <span class="k">new</span> <span class="nf">CloneScheduleInfo</span><span class="p">(</span><span class="n">clone</span><span class="p">,</span> <span class="n">pool</span><span class="p">));</span>
    <span class="p">}</span>
    
    <span class="c1">// Codes...</span>
<span class="p">}</span>

<span class="k">public</span> <span class="n">GameObject</span> <span class="nf">Spawn</span><span class="p">(</span><span class="n">KeyType</span> <span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Codes...</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pool</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">go</span> <span class="p">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">Pop</span><span class="p">();</span>
        <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugSpawn</span><span class="p">,</span> <span class="s">$"Spawn : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">go</span> <span class="p">=</span> <span class="nf">CloneFromSample</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
        <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugSpawn</span><span class="p">,</span> <span class="s">$"Spawn[Create] : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
        
        <span class="c1">// 추가</span>
        <span class="n">_cloneDict</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="k">new</span> <span class="nf">CloneScheduleInfo</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="n">pool</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// Codes...</span>

    <span class="k">return</span> <span class="n">go</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Despawn 실제 처리 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">DespawnInternal</span><span class="p">(</span><span class="n">CloneScheduleInfo</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 예약되어 있던 경우, 해제</span>
    <span class="n">data</span><span class="p">.</span><span class="nf">CancelSchedule</span><span class="p">();</span>

    <span class="c1">// 풀에 집어넣기</span>
    <span class="n">data</span><span class="p">.</span><span class="n">clone</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="n">data</span><span class="p">.</span><span class="n">pool</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">clone</span><span class="p">);</span>

    <span class="nf">TestModeOnly</span><span class="p">(()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">KeyType</span> <span class="n">key</span> <span class="p">=</span> <span class="n">_t_poolKeyDict</span><span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="n">pool</span><span class="p">];</span>

        <span class="c1">// 컨테이너 자식으로 넣기</span>
        <span class="n">data</span><span class="p">.</span><span class="n">clone</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">_t_ContainerDict</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">transform</span><span class="p">);</span>

        <span class="c1">// 컨테이너 이름 변경</span>
        <span class="nf">Test_ChangeContainerName</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; 풀에 집어넣기 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Despawn</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">go</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">go</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">go</span><span class="p">.</span><span class="n">activeSelf</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="c1">// 복제된 게임오브젝트가 아닌 경우 - 정책에 따라 처리</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">_cloneDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">cloneData</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">_nonePoolObjectDespawnPolicy</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">Ignore</span><span class="p">:</span>
                <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"풀에서 제공된 오브젝트가 아닙니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">ThrowException</span><span class="p">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"풀에서 제공된 오브젝트가 아닙니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">Destroy</span><span class="p">:</span>
                <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"풀에서 제공하지 않은 오브젝트를 파괴합니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
                <span class="nf">Destroy</span><span class="p">(</span><span class="n">go</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nf">DespawnInternal</span><span class="p">(</span><span class="n">cloneData</span><span class="p">);</span>

    <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span> <span class="p">&amp;&amp;</span> <span class="n">cloneData</span><span class="p">.</span><span class="n">DespawnScheduled</span><span class="p">,</span> <span class="s">$"Despawn 예약 해제 및 즉시 실행 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
    <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">cloneData</span><span class="p">.</span><span class="n">DespawnScheduled</span><span class="p">,</span> <span class="s">$"Despawn : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; n초 후 풀에 집어넣기 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Despawn</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">go</span><span class="p">,</span> <span class="kt">float</span> <span class="n">seconds</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">go</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">go</span><span class="p">.</span><span class="n">activeSelf</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">version</span><span class="p">;</span>

    <span class="c1">// 1. 풀에서 제공한 오브젝트가 아닌 경우 - 정책에 따라 처리</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_cloneDict</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="k">out</span> <span class="n">CloneScheduleInfo</span> <span class="n">data</span><span class="p">)</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">_nonePoolObjectDespawnPolicy</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">Ignore</span><span class="p">:</span>
                <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"풀에서 제공된 오브젝트가 아닙니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">ThrowException</span><span class="p">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"풀에서 제공된 오브젝트가 아닙니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

            <span class="k">case</span> <span class="n">NonePoolObjectDespawnPolicy</span><span class="p">.</span><span class="n">Destroy</span><span class="p">:</span>
                <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"풀에서 제공하지 않은 오브젝트를 </span><span class="p">{</span><span class="n">seconds</span><span class="p">}</span><span class="s">초 후 파괴합니다 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
                <span class="nf">Destroy</span><span class="p">(</span><span class="n">go</span><span class="p">,</span> <span class="n">seconds</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// 2. 풀에서 제공한 오브젝트가 맞는 경우</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// 0초 이하로 설정한 경우, 즉시 풀에 집어넣기</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">seconds</span> <span class="p">&lt;=</span> <span class="m">0f</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">DespawnInternal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">data</span><span class="p">.</span><span class="n">DespawnScheduled</span><span class="p">,</span> <span class="s">$"</span><span class="p">{</span><span class="n">seconds</span><span class="p">}</span><span class="s">초 후 Despawn 예약 : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
        <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">.</span><span class="n">DespawnScheduled</span><span class="p">,</span> <span class="s">$"</span><span class="p">{</span><span class="n">seconds</span><span class="p">}</span><span class="s">초 후 Despawn 예약[갱신] : </span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">go</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>

        <span class="c1">// 정상 : 예약 설정</span>
        <span class="n">version</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">ScheduleToDespawn</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// 예약</span>
    <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> 
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">prevVersion</span> <span class="p">=</span> <span class="n">version</span><span class="p">;</span>

        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">seconds</span> <span class="p">*</span> <span class="m">1000</span><span class="p">));</span>
                
        <span class="c1">// 예약 정보가 유효한 경우, 큐에 넣기</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">go</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">.</span><span class="nf">IsScheduleValid</span><span class="p">(</span><span class="n">prevVersion</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">_despawnScheduleQueue</span><span class="p">.</span><span class="nf">Enqueue</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Despawn 예약된 오브젝트들 확인하여 처리 &lt;/summary&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">HandleScheduledDespawning</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_despawnScheduleQueue</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">_despawnScheduleQueue</span><span class="p">.</span><span class="nf">TryDequeue</span><span class="p">(</span><span class="k">out</span> <span class="n">CloneScheduleInfo</span> <span class="n">data</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// 예약이 취소된 경우, 종료</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">DespawnScheduled</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="c1">// ------------------------------------------</span>

        <span class="nf">DespawnInternal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

<span class="cp">#if DEBUG_ON
</span>        <span class="k">if</span><span class="p">(</span><span class="n">_debugOn</span> <span class="p">&amp;&amp;</span> <span class="n">data</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">.</span><span class="n">clone</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="nf">DebugLog</span><span class="p">(</span><span class="n">_debugDespawn</span><span class="p">,</span> <span class="s">$"예약된 Despawn 처리 : </span><span class="p">{</span><span class="n">data</span><span class="p">.</span><span class="n">clone</span><span class="p">.</span><span class="n">name</span><span class="p">}</span><span class="s">(</span><span class="p">{</span><span class="n">data</span><span class="p">.</span><span class="n">clone</span><span class="p">.</span><span class="nf">GetInstanceID</span><span class="p">()}</span><span class="s">)"</span><span class="p">);</span>
<span class="cp">#endif
</span>    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">HandleScheduledDespawning</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="10-기타-고려사항">10. 기타 고려사항</h1>
<hr />

<h2 id="dont-destroy-on-load"><strong>Don’t Destroy On Load</strong></h2>

<p>씬이 넘어가면 어차피 풀 내의 모든 게임오브젝트와 샘플 게임오브젝트가 모두 파괴된다.</p>

<p>굳이 <code class="language-plaintext highlighter-rouge">DontDestroyOnLoad</code>를 사용하겠다면 풀링된 게임오브젝트에 전부 적용해야 하는데</p>

<p>그럴 필요가 전혀 없다.</p>

<p>풀링은 어디까지나 씬 내에서 사용될 오브젝트에 대해 제한된다.</p>

<p>그러므로 각 씬마다 <code class="language-plaintext highlighter-rouge">ObjectPoolManager</code>를 하나씩 배치하고</p>

<p>풀링 대상 게임오브젝트들을 등록해주고,</p>

<p><code class="language-plaintext highlighter-rouge">ObjectPoolManager</code>에는 <code class="language-plaintext highlighter-rouge">DontDestroyOnLoad</code>를 적용하지 않는 것이 좋다.</p>

<p>혹시나 싱글톤 클래스에는 무조건 <code class="language-plaintext highlighter-rouge">DontDestroyOnLoad</code>를 적용해야 한다고 생각하고 있었다면, 좀더 유연한 사고를 갖는 것이 좋다.</p>

<p><br /></p>

<h1 id="source-code">Source Code</h1>
<hr />
<ul>
  <li><a href="https://github.com/rito15/Unity-Object-Pooling">https://github.com/rito15/Unity-Object-Pooling</a></li>
</ul>

<p><br /></p>

<h1 id="future-works">Future Works</h1>
<hr />

<ul>
  <li>깔끔한 커스텀 에디터 작성</li>
</ul>



      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/unity/'>Unity</a>,
            <a href='/categories/unity-study/'>Unity Study</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/unity/"
            class="post-tag no-text-decoration" >unity</a>
          
          <a href="/tags/csharp/"
            class="post-tag no-text-decoration" >csharp</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet

 v2.1
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=유니티 - 오브젝트 풀링(Object Pooling) - Rito15&url=https://rito15.github.io/posts/unity-object-pooling/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=유니티 - 오브젝트 풀링(Object Pooling) - Rito15&u=https://rito15.github.io/posts/unity-object-pooling/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=유니티 - 오브젝트 풀링(Object Pooling) - Rito15&url=https://rito15.github.io/posts/unity-object-pooling/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/install-docker-on-windows-10/">Docker - 2. Windows 10 환경에서 도커 설치하기</a></li>
      
        
        
        
        <li><a href="/posts/unity-deltatime-and-fixeddeltatime/">유니티 - Time.deltaTime과 Time.fixedDeltaTime</a></li>
      
        
        
        
        <li><a href="/posts/unity-update-vs-coroutine-every-frame/">유니티 - 매 프레임 처리 성능 테스트 - Update() vs 코루틴</a></li>
      
        
        
        
        <li><a href="/posts/memo-git-command-1-basic/">Git - 명령어 - 1. 기본</a></li>
      
        
        
        
        <li><a href="/posts/unity-memo-show-property-on-inspector/">유니티 - 인스펙터에 프로퍼티 표시하기</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/editor/">editor</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/memo/">memo</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/amplify/">amplify</a>
      
        
        <a class="post-tag" href="/tags/thread/">thread</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.

 v2.0
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/unity-serialize-tree-object/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Sep  6, 2021
  

  <i class="unloaded">2021-09-06T23:23:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>유니티 - 트리 구조 데이터 직렬화하기</h3>
            <div class="text-muted small">
              <p>
                





                트리(Tree) 자료구조


1
2
3
4
class TreeNode
{
    public TreeNode[] children;
}


위와 같이 자기 타입의 배열 또는 컬렉션을 필드로 갖는 구조를 트리 자료구조라고 한다.

자식 및 하위 노드들을 순회하기 위해 재귀적 호출을 많이 사용한다.





직렬화(Serialization)


데이터를 저...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/unity-million-dust-simulation/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Sep 27, 2021
  

  <i class="unloaded">2021-09-27T17:00:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>유니티 - 물리 기반 먼지 시뮬레이션</h3>
            <div class="text-muted small">
              <p>
                





                목표


  수십만 ~ 백만 개의 먼지를 렌더링한다.
  먼지들의 움직임을 물리 기반으로 직접 구현하여 시뮬레이션한다.
  진공 청소기로 먼지들을 예쁘게 빨아들인다.






주요 개념


Compute Buffer

  큰 병렬 데이터를 GPU에 전달하거나 쉐이더끼리 공유하기 위해 사용한다.
  Vert/Frag, Compute Shader에서 S...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/behavior-tree/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Jan  5, 2021
  

  <i class="unloaded">2021-01-05T00:26:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>유니티 - 비헤이비어 트리(Behavior Tree)</h3>
            <div class="text-muted small">
              <p>
                





                개념



  FSM (Finite State Machine)의 단점을 보완하기 위해 만들어진 기법
  FSM에서는 상태 전이 조건을 모두 각각의 상태에서 검사하지만, BT에서는 상태 동작 뿐만 아니라 전이 조건도 노드로 관리한다.
  노드 그래프를 통해 시각화하거나 params, 빌더 패턴 등을 활용하여 스크립트 내에서도 가독성 좋게 구성할 수 있다...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.

  v2.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/unity-web-request/" class="btn btn-outline-primary">
    <p>유니티 - Async Web Request</p>
  </a>
  

  
  <a href="/posts/cs-struct-property-indexer/" class="btn btn-outline-primary">
    <p>C# 구조체 프로퍼티, 구조체 인덱서</p>
  </a>
  

</div>

    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



<script>
/* 코드 블록 우측 상단 Copy 버튼 */
const codes = document.querySelectorAll('.code-button-header + .highlighter-rouge .rouge-code');
const copyCodeButtons = document.querySelectorAll('.copy-code-button');

copyCodeButtons.forEach((copyCodeButton, index) => {
  copyCodeButton.addEventListener('click', () => {
    window.navigator.clipboard.writeText(codes[index].innerText.slice(0, -1));
    copyCodeButton.classList.add('copied');

    setTimeout(() => {
      copyCodeButton.classList.remove('copied');
    }, 2000);
  });
});
</script>


  <!-- image lazy load: https://github.com/ApoorvSaxena/lozad.js -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>

<script type="text/javascript">
  const imgs = document.querySelectorAll('.post-content img');
  const observer = lozad(imgs);
  observer.observe();
</script>




        <!--
  The Footer
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2023
        <a href="https://github.com/rito15">Rito15</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-xl-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/editor/">editor</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/memo/">memo</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/amplify/">amplify</a>
      
        
        <a class="post-tag" href="/tags/thread/">thread</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    
      <!--
  mermaid-js loader
-->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  $(function() {
    let initTheme = "default";

    if ($("html[mode=dark]").length > 0
      || ($("html[mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Markdown converts to HTML */
    $("pre").has("code.language-mermaid").each(function() {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<div class=\"mermaid\">${svgCode}</div>`);
    });

    mermaid.initialize(mermaidConf);
  });
</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://rito15.github.io{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    <div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div>    <div><i class="fa fa-tag fa-fw"></i>{tags}</div>  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>'
});
</script>


    <!-- 2021-06-29 추가 : 애널리틱스 적용 -->
    <!--
  The GA snippet
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-200391565-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-200391565-1');
</script>


  </body>

</html>

